angular.module("ngAmbassador.tables",["smartTable.table","ambassador.table.filters","ngAmbassador.services","ngAmbassador.api","ngAmbassador.alerts"]),function(global,angular){"use strict";var smartTableColumnModule=angular.module("smartTable.column",[]).constant("DefaultColumnConfiguration",{isSortable:!0,isEditable:!1,type:"text",headerTemplateUrl:"",map:"",label:"",group:"",sortPredicate:"",formatFunction:"",formatParameter:"",filterPredicate:"",cellTemplate:"",cellTemplateUrl:"",headerClass:"",cellClass:"",saving:!1,width:"",maxWidth:"",pinnedWidth:0});function ColumnProvider(DefaultColumnConfiguration){function Column(config){if(!(this instanceof Column))return new Column(config);angular.extend(this,config)}this.setDefaultOption=function(option){angular.extend(Column.prototype,option)},DefaultColumnConfiguration.headerTemplateUrl="../ambassador/templates/table/table.default-header.html",this.setDefaultOption(DefaultColumnConfiguration),this.$get=function(){return Column}}ColumnProvider.$inject=["DefaultColumnConfiguration"],smartTableColumnModule.provider("Column",ColumnProvider),global.ColumnProvider=ColumnProvider}(window,angular),function(angular){"use strict";angular.module("smartTable.directives",["ui.bootstrap.position"]).directive("smartTable",["DefaultTableConfiguration","$injector","$timeout","$window",function(defaultConfig,$injector,$timeout,$window){return{restrict:"EA",scope:{dataSource:"=rows",columnCollection:"=columns",config:"=",exposedData:"=?"},replace:"true",templateUrl:"../ambassador/templates/table/table.html",controller:"SmartTableCtrl",link:function(scope,element,attr,ctrl){for(var tablesThusFar=angular.element(document.getElementsByClassName("smart-table-container")),i=tablesThusFar.length;0<=i;i--)element[0]===tablesThusFar[i]&&(scope.tableId=i);if(scope.tableSize={table:0,wrapper:0},scope.tablePinningActive=!1,scope.columnCollection){i=0;for(var l=scope.columnCollection.length;i<l;i++)ctrl.insertColumn(scope.columnCollection[i])}function setTablePinning(){var tableElem=_.find(element.find("table"),function(table){return table.classList.contains("smart-table")});tableElem.getBoundingClientRect().width>angular.element(angular.element(tableElem).parent())[0].getBoundingClientRect().width-4?$timeout(function(){scope.$broadcast("SET_ROW_HEIGHT",{tableId:scope.tableId}),scope.tablePinningActive=!0,element.addClass("table-pinning-active")}):$timeout(function(){scope.tablePinningActive=!1,element.removeClass("table-pinning-active")})}scope.config.useServer=!angular.isDefined(scope.dataSource),scope.$on("FILTERS_CHANGED",function(){$timeout(function(){scope.currentPage=1,scope.$broadcast("UPDATE_PAGINATION"),ctrl.filterTable()})}),function(){var newConfig=angular.extend({},defaultConfig,scope.config),length=void 0!==scope.columns?scope.columns.length:0;if(scope.table={load:!1},void 0!==scope.config.tableFilterSetType?(scope.table.load=!1,scope.filterSetType=scope.config.tableFilterSetType):(scope.table.load=!0,scope.filterSetType=""),scope.filters=[],void 0===scope.config.searchPlacement&&(scope.config.searchPlacement="right"),ctrl.setGlobalConfig(newConfig),newConfig.dependencies)for(var x=0;x<newConfig.dependencies.length;x++)scope[newConfig.dependencies[x]]=$injector.get(newConfig.dependencies[x]);if("multiple"!==newConfig.selectionMode&&"single"!==newConfig.selectionMode||!0!==newConfig.displaySelectionCheckbox)for(var i=length-1;0<=i;i--)!0===scope.columns[i].isSelectionColumn&&ctrl.removeColumn(i);else ctrl.insertColumn({cellTemplateUrl:"../ambassador/templates/table/table.select-checkbox.html",headerTemplateUrl:"../ambassador/templates/table/table.select-all-checkbox.html",isSelectionColumn:!0,isSortable:!1,cellClass:"smart-table-checkbox-cell",headerClass:"smart-table-checkbox-header-cell",pinnedWidth:40},0);angular.isDefined(newConfig.manageActions)&&!0!==newConfig.editDeleteBtns&&!0!==newConfig.manageBtns&&(angular.isUndefined(newConfig.tableActionButtons)||!1===newConfig.tableActionButtons)&&ctrl.insertColumn({cellTemplate:"<manage-table-btn></manage-table-btn>",isSortable:!1,cellClass:"smart-table-manage-cell",headerClass:"smart-table-header-manage-cell"},scope.columns.length),!0!==newConfig.editDeleteBtns||!angular.isUndefined(newConfig.tableActionButtons)&&!1!==newConfig.tableActionButtons||ctrl.insertColumn({cellTemplate:"<table-edit-delete></table-edit-delete>",isSortable:!1},scope.columns.length),newConfig.useServer||scope.$watch("dataSource.length",function(newValue,oldValue){oldValue!==newValue&&(scope.dataCollection=scope.dataSource,0===scope.dataCollection.length?scope.noResults=!0:scope.noResults=!1,ctrl.setRowsLength(),ctrl.sortBy())})}(),ctrl.setTableFilters(),scope.tableActions={show:!1,minimized:!1},scope.minimizeActionButtons=function(){var tableElem=_.find(element.find("table"),function(table){return table.classList.contains("smart-table")}),searchWrapper=0<element[0].getElementsByClassName("smart-table-search").length?element[0].getElementsByClassName("smart-table-search")[0]:null,filtersWrapper=0<element[0].getElementsByClassName("smart-table-actions").length?element[0].getElementsByClassName("smart-table-actions")[0]:null,actionsWrapper=0<element[0].getElementsByClassName("table-actions-original-width").length?element[0].getElementsByClassName("table-actions-original-width")[0]:null;if(actionsWrapper){var searchFiltersWidth=0;searchFiltersWidth+=searchWrapper?searchWrapper.getBoundingClientRect().width:0,searchFiltersWidth+=filtersWrapper?filtersWrapper.getBoundingClientRect().width:0;var tableWidth=angular.element(angular.element(tableElem).parent())[0].getBoundingClientRect().width,smartTableHeader=element[0].getElementsByClassName("smart-table-header-wrapper")[0];tableWidth-searchFiltersWidth-(parseInt(window.getComputedStyle(smartTableHeader).paddingLeft)+parseInt(window.getComputedStyle(smartTableHeader).paddingRight))<actionsWrapper.getBoundingClientRect().width?(scope.tableActions.minimized=!0,element.addClass("table-action-buttons-minimized")):(scope.tableActions.minimized=!1,element.removeClass("table-action-buttons-minimized")),$timeout(function(){scope.tableActions.show=!0})}};var counter=0,waitForTableToRender=scope.$watch(function(){return 0<element.find("table").length?element.find("table")[0].getBoundingClientRect().width:0},function(newValue,oldValue){0<newValue&&(10<=++counter&&waitForTableToRender(),setTablePinning(),scope.minimizeActionButtons()),element.removeClass("invisible")});angular.element($window).bind("resize",function(){setTablePinning(),scope.minimizeActionButtons()}),function(){function sameOrNull(something){return void 0!==something&&something?something:null}for(var C=scope.columns,N=C.length,tableMargin=0,y=scope.tablePinnedCols-1;0<=y;y--)tableMargin+=C[y].pinnedWidth;function calculateCellStyles(isHeader){isHeader=!!isHeader;var styles=new Array(N);for(i=0;i<N;i++)styles[i]=isHeader?{"text-align":sameOrNull(C[i].align),width:sameOrNull(C[i].width)}:{"text-align":sameOrNull(C[i].align),"min-width":i<scope.tablePinnedCols?C[i].pinnedWidth+"px":null,"max-width":i<scope.tablePinnedCols&&!sameOrNull(C[i].maxWidth)?C[i].pinnedWidth+"px":sameOrNull(C[i].maxWidth)};return styles}function calculateCellPinnedStyles(isHeader){isHeader=!!isHeader;var i,pinnedStyles=new Array(N),heightStyle=!isHeader&&scope.tablePinnedHeight?scope.tablePinnedHeight+"px":null,left=2;for(i=0;i<scope.tablePinnedCols;i++){var thisWidth=C[i].pinnedWidth;pinnedStyles[i]={width:thisWidth+"px",left:left+"px",height:heightStyle},left+=thisWidth}if(heightStyle)for(;i<N;i++)pinnedStyles[i]={height:heightStyle};return pinnedStyles}function stylesToCSS(styleObj){var str="";for(var key in styleObj)styleObj.hasOwnProperty(key)&&styleObj[key]&&(str+=key+":"+styleObj[key]+";");return str}function assembleCellCSS(cellSelector,cellStyles){for(var styleString="",i=cellStyles.length-1;0<=i;i--)if(void 0!==cellStyles[i]){var thisCellCSS=stylesToCSS(cellStyles[i]);thisCellCSS&&(styleString+=cellSelector+":nth-child("+(i+1)+"){"+thisCellCSS+"}")}return styleString}for(var tableSelector='.smart-table-container[ga-smart-table-id="'+scope.tableId+'"] table',headerCellStyles=calculateCellStyles(!0),dataCellStyles=calculateCellStyles(!1),dataCellSelector=tableSelector+" td.smart-table-data-cell",headerCellsCSS=assembleCellCSS(tableSelector+" th.smart-table-header-cell",headerCellStyles),dataCellsCSS=assembleCellCSS(dataCellSelector,dataCellStyles),pinnedTableSelector='.smart-table-container[ga-smart-table-id="'+scope.tableId+'"].table-pinning-active table[class*="pinned-"]',headerCellPinnedStyles=calculateCellPinnedStyles(!0),dataCellPinnedStyles=calculateCellPinnedStyles(!1),dataCellPinnedSelector=pinnedTableSelector+" td.smart-table-data-cell",styleStr=headerCellsCSS+dataCellsCSS+pinnedTableSelector+"{padding-left:"+tableMargin+"px;}"+assembleCellCSS(pinnedTableSelector+" th.smart-table-header-cell",headerCellPinnedStyles)+assembleCellCSS(dataCellPinnedSelector,dataCellPinnedStyles),styleEl=null,styleElements=document.head.getElementsByTagName("style"),i=styleElements.length-1;0<=i;i--)if(styleElements[i].getAttribute("ga-smart-table-id")==scope.tableId){styleEl=angular.element(styleElements[i]);break}null===styleEl&&((styleEl=angular.element("<style>")).attr("ga-smart-table-id",scope.tableId),angular.element(document.head).append(styleEl)),styleEl.text(styleStr)}()}}}]).directive("smartTableDataRow",["$compile","$uibPosition","$document","$timeout",function($compile,$uibPosition,$document,$timeout){return{require:"^smartTable",restrict:"C",link:function(scope,element,attr,ctrl){scope.initialCellHeights=[],scope.setRowHeight=function(){for(var heights=_.union(scope.initialCellHeights,[element[0].getBoundingClientRect().height]),height=_.max(heights),cells=element.children(),i=0;i<element.children().length;i++)i<scope.tablePinnedCols?angular.element(cells[i])[0].style.minHeight=height+"px":angular.element(cells[i])[0].style.height=height+"px"},scope.$on("SET_ROW_HEIGHT",function(event,args){args.tableId!==scope.tableId||scope.tablePinnedHeight&&0!==scope.tablePinnedHeight||scope.setRowHeight()});var _config;null!==(_config=scope.config)&&"function"==typeof _config.rowFunction&&_config.rowFunction(scope,element,attr,ctrl)}}}]).directive("smartTableHeaderCell",function(){return{restrict:"C",require:"^smartTable",link:function(scope,element,attr,ctrl){element.bind("click",function(event){"INPUT"!==event.target.nodeName&&scope.column.isSortable&&scope.$apply(function(){ctrl.sortBy(scope.column)})})}}}).directive("smartTableSelectAll",function(){return{restrict:"C",require:"^smartTable",link:function(scope,element,attr,ctrl){element.bind("click",function(event){ctrl.toggleSelectionAll(!0===element[0].checked)})}}}).directive("stopEvent",function(){return{restrict:"A",link:function(scope,element,attr){element.bind(attr.stopEvent,function(e){e.stopPropagation()})}}}).directive("smartTableSearch",["$api","$errors",function($api,$errors){return{restrict:"C",require:"^smartTable",scope:{columnSpan:"@",tableEmpty:"="},templateUrl:"../ambassador/templates/table/table.search-cell.html",replace:!1,link:function(scope,element,attr,ctrl){var searchValueLoaded=!1;""!==scope.$parent.saved.searchString?(scope.searchValue=scope.$parent.saved.searchString.search,searchValueLoaded=!0):scope.searchValue="",scope.$watch("searchValue",function(newValue,oldValue){newValue===oldValue&&!searchValueLoaded||(ctrl.search(newValue,null,searchValueLoaded),searchValueLoaded=!1)}),element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){ctrl.search(scope.searchValue,null,!0)}),event.preventDefault())}),scope.$on("CLEAR_SEARCH",function(){searchValueLoaded=!0,scope.searchValue=""})}}}]).directive("tableExternalOrdering",[function(){return{restrict:"C",templateUrl:"../ambassador/templates/table/table.external-ordering.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){scope.getData=function(order){scope.externalOrderingOpen=!1;var ordering={sortPredicate:(scope.selectedOrder=order).predicate,reverse:!1};ctrl.sortByNonColumn(ordering)}}}}]).directive("tableApplyAction",function(){return{restrict:"C",templateUrl:"../ambassador/templates/table/table.apply-action.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){scope.applyAction={isOpen:!1},scope.action=function(a){var selected=function(){var i,l=scope.displayedCollection.length,rowsSelected=[];for(i=0;i<l;i++)scope.displayedCollection[i].isSelected&&rowsSelected.push(scope.displayedCollection[i]);return rowsSelected}();scope.applyAction.isOpen=!1,0<selected.length&&(!0===a.loader&&ctrl.showLoader(!0),a.action(selected,function(tableAction){ctrl.toggleSelectionAll(!1),void 0!==tableAction&&("deleteRows"===tableAction?ctrl[tableAction](selected):ctrl[tableAction]())}))}}}}).directive("tableActionButtons",["$timeout",function($timeout){return{restrict:"C",templateUrl:"../ambassador/templates/table/table.actions.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){function getSelected(){var i,l=scope.displayedCollection.length,rowsSelected=[];for(i=0;i<l;i++)scope.displayedCollection[i].isSelected&&rowsSelected.push(scope.displayedCollection[i]);return rowsSelected}scope.numSelected=0,scope.range=_.range(2),scope.loading={manage:[],default:[]},scope.manageActions&&angular.forEach(scope.manageActions,function(){scope.loading.manage.push(!1)}),scope.defaultActions&&angular.forEach(scope.defaultActions,function(){scope.loading.default.push(!1)}),scope.$on("TABLE_UPDATED",function(){for(var i=0;i<scope.dataCollection;i++)scope.dataCollection[i].isSelected=!1;ctrl.toggleSelectionAll(!1)}),scope.$on("RESET_SELECT_ALL",function(event,args){args.tableId===scope.tableId&&(scope.numSelected=0,scope.tableActions.minimized||(scope.tableActions.show=!1),scope.minimizeActionButtons())}),scope.$on("ITEM_SELECTED",function(event,data){$timeout(function(){void 0!==data&&data.row.isSelected&&(scope.dataRow=data.row);var oldNumSelected=scope.numSelected;scope.numSelected=getSelected().length,scope.tableActions.minimized||1!==scope.numSelected||oldNumSelected===scope.numSelected||(scope.tableActions.show=!1),$timeout(function(){scope.minimizeActionButtons()})})}),scope.action=function(a){var selected=getSelected();0<selected.length&&(!0===a.loader&&ctrl.showLoader(!0),a.action(selected,function(tableAction){ctrl.toggleSelectionAll(!1),void 0!==tableAction&&("deleteRows"===tableAction?ctrl[tableAction](selected):ctrl[tableAction]())}))},scope.actionSingle=function(action,index){var item=getSelected()[0];action(item,function(tableAction){ctrl.toggleSelectionAll(!1),void 0!==tableAction&&ctrl[tableAction](item)},function(status){scope.loading.manage[index]=status})},scope.actionDefault=function(a,index){var selected=0===getSelected().length?scope.displayedCollection:getSelected(),btnSpinnerFunc=a.loader?null:function(status){(scope.loading.default[index]=status)||ctrl.toggleSelectionAll(!1)};!0===a.loader&&ctrl.showLoader(!0),a.action(selected,function(tableAction){ctrl.toggleSelectionAll(!1),void 0!==tableAction&&ctrl[tableAction]()},btnSpinnerFunc)}}}}]).directive("displayPerPage",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.display-per-page.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){var waitForEndpoint=scope.$watch("apiEndpoint",function(){var string;angular.isDefined(scope.apiEndpoint)&&(scope.label=angular.isDefined(scope.paginateLabel)?scope.paginateLabel:(string=scope.apiEndpoint).charAt(0).toUpperCase()+string.slice(1),waitForEndpoint())});scope.pageResults=[{text:"10 results",value:10},{text:"25 results",value:25},{text:"50 results",value:50},{text:"100 results",value:100}],scope.setDisplayPerPage=function(value){scope.setItemsPerPage(value),ctrl.setCurrentPage(1),scope.useServer?ctrl.updateTable():(scope.displayedCollection=ctrl.pipe(scope.dataCollection),ctrl.setPageDisplay())}}}}).directive("manageTableBtn",["$parse",function($parse){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.manage-action-dropdown.html",require:"^?smartTable",link:function(scope,element,attrs,ctrl){if(scope.showTags=!1,scope.manageActionTags){scope.tags=angular.copy(scope.manageActionTags);for(var i=0;i<scope.tags.length;i++)scope.tags[i].active=$parse(scope.tags[i].show)(scope),!0===scope.tags[i].active&&(scope.showTags=!0)}scope.loading=!1,scope.spinnerConf={radius:3,width:2,length:3,lines:9,color:"#ffffff"},scope.action=function(action){action(scope.dataRow,function(tableAction){ctrl.updateTable()},function(status){scope.loading=status})},scope.isZero=function(amount){return 0===parseFloat(amount)},scope.isOpen=!1}}}]).directive("tableEditDelete",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.manage-action-buttons.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){scope.loading=[],angular.forEach(scope.manageActions,function(){scope.loading.push(!1)}),scope.spinnerConf={radius:3,width:2,length:3,lines:9,color:"#ffffff"},scope.action=function(action,index){action(scope.dataRow,function(tableAction){void 0!==tableAction&&ctrl[tableAction](scope.dataRow)},function(status){scope.loading[index]=status})}}}}).directive("tooltipCell",function(){return{restrict:"E",templateUrl:"../ambassador/templates/table/table.tooltip-cell.html",require:"^smartTable",link:function(scope,element,attrs,ctrl){}}}).directive("smartTableDataCell",["$filter","$http","$templateCache","$compile","$parse","$window",function(filter,http,templateCache,compile,parse,$window){return{restrict:"C",template:'<div ng-if="column.cellTemplateUrl" ng-include="column.cellTemplateUrl"></div>',compile:function(element,attributes){return{pre:function(scope,element,attributes,controller,transcludeFn){var childScope,column=scope.column,format=filter("format"),row=scope.dataRow,getter=parse(column.map),count=0;if(scope.$index<scope.tablePinnedCols&&(!scope.tablePinnedHeight||0===scope.tablePinnedHeight))var waitForCellToRender=scope.$watch(function(){return 5<=++count&&waitForCellToRender(),element[0].getBoundingClientRect().height},function(newValue){setCellHeight(newValue)});function setCellHeight(height){scope.initialCellHeights[scope.$index]=height}column.cellTemplateUrl||(column.cellTemplate?(childScope=scope.$new(),element.html(column.cellTemplate),compile(element.contents())(childScope)):(scope.formattedValue=format(getter(row),column.formatFunction,column.formatParameter),element.text(scope.formattedValue))),angular.element($window).bind("resize",function(){setCellHeight(element[0].getBoundingClientRect().height)})}}}}}]).directive("inputType",function(){return{restrict:"A",priority:1,link:function(scope,ielement,iattr){var type=scope.$eval(iattr.type);iattr.$set("type",type)}}}),angular.module("smartTable.filters",[]).constant("DefaultFilters",["currency","date","json","lowercase","number","uppercase"]).filter("format",["$filter","DefaultFilters",function(filter,defaultfilters){return function(value,formatFunction,filterParameter){return(formatFunction&&angular.isFunction(formatFunction)?formatFunction:-1!==defaultfilters.indexOf(formatFunction)?filter(formatFunction):function(value){return value})(value,filterParameter)}}]),angular.module("smartTable.table",["smartTable.column","smartTable.utilities","smartTable.directives","smartTable.filters","ui.bootstrap.pagination.smartTable"]).constant("DefaultTableConfiguration",{selectionMode:"none",isGlobalSearchActivated:!1,isSearchActive:!0,displaySelectionCheckbox:!1,isPaginationEnabled:!0,isTopPaginationEnabled:!1,itemsByPage:10,maxSize:3,dependencies:[],apiEndpoint:"",tableClass:"",defaultParams:{},sortAlgorithm:"",filterAlgorithm:"",colGroupings:[],tablePinnedCols:0,tablePinnedHeight:0,trackById:null}).controller("SmartTableCtrl",["$scope","$rootScope","Column","$filter","$parse","ArrayUtility","DefaultTableConfiguration","$api","$timeout","$promiseKeeper","$errors",function(scope,rootScope,Column,filter,parse,arrayUtility,defaultConfig,$api,$timeout,$promiseKeeper,$errors){scope.columns=[],scope.dataCollection=scope.dataSource||[],scope.displayedCollection=[],scope.numberOfPages=0,scope.currentPage=1,scope.holder={isAllSelected:!1},scope.useServer=!1,scope.tableLoader=!1,scope.noResults=!1,scope.tableEmpty=!1,scope.saved={filtersId:void 0,searchString:""},scope.fullDatasetLoad=!(!angular.isArray(scope.exposedData)||0!==scope.exposedData.length);var lastColumnSort,search,tableLoaderPromise,predicate={},self=this;function setColGroups(){for(var colGroups=[],colIncrement=0,i=0;i<scope.colGroupings.length;i++){if(scope.colGroupings[i].start>colIncrement)for(var x=colIncrement;x<scope.colGroupings[i].start;x++)colGroups.push({label:"",length:1}),colIncrement++;colIncrement+=scope.colGroupings[i].length,colGroups.push(scope.colGroupings[i])}if(colIncrement!==scope.columns.length)for(x=colIncrement;x<scope.columns.length;x++)colGroups.push({label:"",length:1});return colGroups}function isAllSelected(){var i,l=scope.displayedCollection.length;for(i=0;i<l;i++)if(!0!==scope.displayedCollection[i].isSelected)return!1;return!0}function selectDataRow(array,selectionMode,index,select){var dataRow,oldValue;if(angular.isArray(array)&&("multiple"===selectionMode||"single"===selectionMode)&&0<=index&&index<array.length){if(dataRow=array[index],"single"===selectionMode)for(var i=0,l=array.length;i<l;i++)oldValue=array[i].isSelected,!(array[i].isSelected=!1)===oldValue&&scope.$emit("selectionChange",{item:array[i]});dataRow.isSelected=select,scope.holder.isAllSelected=isAllSelected(),scope.$emit("selectionChange",{item:dataRow})}}function setOrdering(column){return column.reverse?"-"+column.sortPredicate:column.sortPredicate}function filterTableServer(data){rootScope.$broadcast("TABLE_FINISHED_LOADING",{tableId:scope.tableId,count:data.length,filters:scope.filters,search:scope.config.search}),scope.fullDatasetLoad?(scope.exposedData=angular.copy(data),scope.displayedCollection=data.splice(scope.currentPage*scope.itemsByPage-scope.itemsByPage,scope.itemsByPage),scope.fullDatasetLoad=!1):scope.displayedCollection=data,rootScope.$broadcast("RESET_SELECT_ALL",{tableId:scope.tableId}),$timeout(function(){scope.$broadcast("SET_ROW_HEIGHT",{tableId:scope.tableId})}),scope.totalRows=data.count,self.calculateNumberOfPages(scope.totalRows),self.setPageDisplay()}scope.$on("RESET_SELECT_ALL",function(event,args){if(args.tableId===scope.tableId){for(var i=0;i<scope.dataCollection;i++)scope.dataCollection[i].isSelected=!1;scope.holder.isAllSelected=!1}}),scope.isColInGroup=function(colIndex){for(var colIncrement=0,i=0;i<scope.colGroups.length;i++)if(colIndex<=(colIncrement+=scope.colGroups[i].length)-1)return""!==scope.colGroups[i].label},scope.isGroupBorder=function(colIndex){for(var colIncrement=0,i=0;i<scope.colGroups.length;i++)if(colIndex<=(colIncrement+=scope.colGroups[i].length)-1){if(""!==scope.colGroups[i].label&&colIndex===scope.colGroups[i].start)return colIndex-1!=scope.colGroups[i-1].start+scope.colGroups[i-1].length-1?"start":"start-no-border";if(""!==scope.colGroups[i].label&&colIndex===scope.colGroups[i].start+scope.colGroups[i].length-1)return"end"}},scope.updateFilters=function(newFilters){if(void 0!==newFilters&&(scope.filters=newFilters,scope.$broadcast("FILTERS_CHANGED")),void 0!==scope.filterSetType&&""!==scope.filterSetType)if(void 0!==scope.saved.filtersId){for(var searchSaved=void 0,found=!1,i=0;i<scope.saved.filters.length;i++)if(void 0!==scope.saved.filters[i].search){scope.searchChanged?(scope.saved.filters[i].search=scope.config.search,found=!0):searchSaved=scope.saved.filters[i];break}scope.searchChanged||(scope.saved.filters=scope.filters.slice(),void 0!==searchSaved&&scope.saved.filters.push(searchSaved)),scope.searchChanged&&!found&&scope.saved.filters.push({search:scope.config.search}),$api.use("default").one("filters",scope.saved.filtersId).patch({filters:scope.saved.filters}).then(function(data){},function(error){$errors.output({alertSystem:"table-filter-alerts",alertSystemType:"page",defaultMessage:"There was an error saving your filter set. Please try removing the last filter and adding it again if you want it to be saved."},error.data)})}else{var filterSet={name:scope.filterSetType+" filters",type:scope.filterSetType,filters:scope.searchChanged?[{search:scope.config.search}]:scope.filters};$api.use("default").all("filters").post(filterSet).then(function(data){scope.saved.filtersId=data.id},function(error){$errors.output({alertSystem:"table-filter-alerts",alertSystemType:"page",defaultMessage:"There was an error saving your filter set. Please try removing the last filter and adding it again if you want it to be saved."},error.data)})}scope.searchChanged=!1},scope.setItemsPerPage=function(value){scope.itemsByPage=value},scope.clearSearch=function(){scope.$broadcast("CLEAR_SEARCH")},scope.itemSelected=function(dataRow){if("single"===scope.selectionMode)for(var i=0,l=scope.displayedCollection.length;i<l;i++){var oldValue=scope.displayedCollection[i].isSelected;!(scope.displayedCollection[i].isSelected=!1)===oldValue&&scope.$emit("selectionChange",{item:scope.displayedCollection[i]})}scope.$broadcast("ITEM_SELECTED",{row:dataRow}),$timeout(function(){scope.holder.isAllSelected=isAllSelected()})},scope.getRowIndex=function(dataRow){return scope.displayedCollection.indexOf(dataRow)},scope.$on("EXPORT_COLLECTION",function(){scope.tableData.displayedCollection=scope.displayedCollection}),scope.$on("UPDATE_TABLE",function(){angular.isArray(scope.exposedData)&&(scope.currentPage=1,scope.$broadcast("UPDATE_PAGINATION"),scope.fullDatasetLoad=!0),self.updateTable()}),this.setRowsLength=function(){scope.totalRows=scope.dataCollection.length},this.calculateNumberOfPages=function(total){scope.numberOfPages=0===total||scope.itemsByPage<1?1:Math.ceil(total/scope.itemsByPage),scope.$broadcast("UPDATE_PAGINATION")},this.setPageDisplay=function(){var rowsShowing=scope.itemsByPage;scope.pageStartNumber=(scope.currentPage-1)*rowsShowing+1,scope.pageEndNumber=(scope.currentPage-1)*rowsShowing+scope.displayedCollection.length},this.setGlobalConfig=function(config){angular.extend(scope,defaultConfig,config)},this.changePage=function(page){var oldPage=scope.currentPage;angular.isNumber(page.page)&&(scope.currentPage=page.page,scope.$broadcast("UPDATE_PAGINATION"),scope.useServer?this.getData().then(function(data){filterTableServer(data)}):(scope.displayedCollection=this.pipe(scope.dataCollection),scope.holder.isAllSelected=isAllSelected(),this.setPageDisplay(),scope.$emit("changePage",{oldValue:oldPage,newValue:scope.currentPage})))},this.sortBy=function(column){-1!==scope.columns.indexOf(column)&&!0===column.isSortable&&(lastColumnSort&&lastColumnSort!==column&&(lastColumnSort.reverse="none"),column.sortPredicate=column.sortPredicate||column.map,column.reverse=!0!==column.reverse,lastColumnSort=column),scope.useServer?this.getData(column).then(function(data){filterTableServer(data)}):(scope.displayedCollection=this.pipe(scope.dataCollection),this.setPageDisplay())},this.sortByNonColumn=function(params){lastColumnSort=params,scope.useServer?(this.setCurrentPage(1),this.getData(params).then(function(data){filterTableServer(data)})):(scope.displayedCollection=this.pipe(scope.dataCollection),this.setPageDisplay())},this.search=function(input,column,instant){scope.config.search=input,(scope.searchChanged=!0)===instant?($timeout.cancel(search),scope.currentPage=1,scope.$broadcast("UPDATE_PAGINATION"),self.getData().then(function(data){filterTableServer(data),scope.updateFilters(),scope.saved.searchString={search:scope.config.search}})):(column&&-1!==scope.columns.indexOf(column)?predicate[column.map]=input:predicate={$:input},scope.useServer?(void 0!==search&&$timeout.cancel(search),search=$timeout(function(){scope.currentPage=1,scope.$broadcast("UPDATE_PAGINATION"),self.getData().then(function(data){filterTableServer(data),scope.updateFilters(),scope.saved.searchString={search:scope.config.search}})},1500)):(scope.currentPage=1,scope.$broadcast("UPDATE_PAGINATION"),scope.displayedCollection=this.pipe(scope.dataCollection),scope.updateFilters()))},this.pipe=function(array){var output,filterAlgo=!0===(scope.filterAlgorithm&&angular.isFunction(scope.filterAlgorithm))?scope.filterAlgorithm:filter("filter");return output=function(array,column){var sortAlgo=!0===(scope.sortAlgorithm&&angular.isFunction(scope.sortAlgorithm))?scope.sortAlgorithm:filter("orderBy");return column?arrayUtility.sort(array,sortAlgo,column.sortPredicate,column.reverse):array}(arrayUtility.filter(array,filterAlgo,predicate),lastColumnSort),this.calculateNumberOfPages(scope.totalRows),scope.isPaginationEnabled?arrayUtility.fromTo(output,(scope.currentPage-1)*scope.itemsByPage,scope.itemsByPage):output},this.updateTable=function(){this.getData().then(function(data){filterTableServer(data),rootScope.$broadcast("TABLE_UPDATED");for(var i=scope.numSelected=0;i<scope.dataCollection;i++)scope.dataCollection[i].isSelected=!1;scope.holder.isAllSelected=!1})},this.filterTable=function(){var filtered;scope.useServer||function(){for(var i=0,l=scope.filters.length;i<l;i++)if(void 0===scope.filters[i].filterFunc)return 1}()?self.getData().then(function(data){filterTableServer(data)}):(filtered=scope.dataCollection,angular.forEach(scope.filters,function(filter){filtered=filtered.filter(function(item){return filter.filterFunc(item,filter)})}),scope.totalRows=filtered.length,scope.displayedCollection=this.pipe(filtered),this.setPageDisplay())},this.showLoader=function(){$promiseKeeper.getActive()?void 0!==tableLoaderPromise&&"success"!==tableLoaderPromise.status||(tableLoaderPromise=$promiseKeeper.add()):scope.tableLoader=!0},this.setCurrentPage=function(page){scope.currentPage=page,scope.$broadcast("UPDATE_PAGINATION")},this.hideLoader=function(){scope.tableLoader=!1,void 0!==tableLoaderPromise&&tableLoaderPromise.deferred.resolve()},this.getData=function(column){var data,searchConfig={},filters=function(filtersArray){var filters={};return angular.isDefined(filtersArray)&&0!==filtersArray.length&&filtersArray.forEach(function(filter){filters[filter.param]=filter.param_val}),filters}(scope.filters),search=void 0===scope.config.search||""===scope.config.search?{}:{search:scope.config.search},orderParam=scope.config.displayTopAmbassadorsOrdering?"stat":"ordering";(scope.currentPage-1)*scope.itemsByPage>=scope.totalRows-scope.deletingRows&&(1<scope.currentPage&&scope.currentPage--,scope.deletingRows=0),angular.extend(searchConfig,scope.defaultParams,search,filters,{page:scope.currentPage,page_size:scope.fullDatasetLoad?0:scope.itemsByPage}),void 0!==lastColumnSort?searchConfig[orderParam]=setOrdering(lastColumnSort):void 0!==column?searchConfig[orderParam]=setOrdering(column):void 0!==scope.startingOrder&&(searchConfig[orderParam]=scope.startingOrder),self.showLoader();var ignoredParams=_.union(["page","page_size","ordering"],_.keys(scope.defaultParams));return(data=$api.use("default").all(scope.apiEndpoint).getList(searchConfig)).then(function(results){if(0===results.length)for(var key in scope.noResults=!0,scope.tableEmpty=!0,searchConfig)-1===ignoredParams.indexOf(key)&&(scope.tableEmpty=!1);else scope.noResults=!1;self.hideLoader()},function(error){scope.noResults=!0,self.hideLoader(),1<scope.currentPage?(scope.currentPage--,self.updateTable()):$errors.output({alertSystem:"table-filter-alerts",alertSystemType:"page",defaultMessage:'There was an error while loading the table. Please try reloading the page or contact <a href="mailto:support@getambassador.com">support</a> if the problem persists.'},error.data)}),data},this.setTableFilters=function(){void 0!==scope.config.tableFilterSetType?(scope.colGroups=setColGroups(),$api.use("default").all("filters").getList({type:scope.config.tableFilterSetType}).then(function(data){if(data[0]&&void 0!==data[0].id){scope.saved.filtersId=data[0].id,scope.saved.filters=data[0].filters||[];for(var removeIndex=null,i=0;i<scope.saved.filters.length;i++)if(void 0!==scope.saved.filters[i].search){removeIndex=i,scope.config.search=scope.saved.filters[i].search;break}var temp=null!==removeIndex?((temp=scope.saved.filters.slice()).splice(removeIndex,1),temp):scope.saved.filters.slice();scope.filters=temp,0<scope.filters.length&&!removeIndex&&scope.$broadcast("FILTERS_CHANGED"),scope.saved.searchString=null!==removeIndex?scope.saved.filters[removeIndex]:{search:""}}else scope.saved.filters=[],self.initialize();scope.table.load=!0},function(error){$errors.output({alertSystem:"table-filter-alerts",alertSystemType:"page",defaultMessage:"There was an error fetching your previously saved filter set. Please reload the page to try again."},error.data),scope.table.load=!0})):self.initialize()},this.initialize=function(){scope.colGroups=setColGroups(),self.getData().then(function(data){filterTableServer(data)})},this.insertColumn=function(columnConfig,index){var column=new Column(columnConfig);arrayUtility.insertAt(scope.columns,index,column)},this.removeColumn=function(columnIndex){arrayUtility.removeAt(scope.columns,columnIndex)},this.moveColumn=function(oldIndex,newIndex){arrayUtility.moveAt(scope.columns,oldIndex,newIndex)},this.clearColumns=function(){scope.columns.length=0},this.toggleSelection=function(dataRow){var index=scope.dataCollection.indexOf(dataRow);-1!==index&&selectDataRow(scope.dataCollection,scope.selectionMode,index,!0!==dataRow.isSelected)},this.toggleSelectionAll=function(value){for(var i=0,l=scope.displayedCollection.length;i<l;i++)selectDataRow(scope.displayedCollection,scope.selectionMode,i,!0===value);!1===value&&(scope.holder.isAllSelected=!1),scope.$broadcast("ITEM_SELECTED"),$timeout(function(){scope.minimizeActionButtons()})},this.removeDataRow=function(rowIndex){var toRemove=arrayUtility.removeAt(scope.displayedCollection,rowIndex);arrayUtility.removeAt(scope.dataCollection,scope.dataCollection.indexOf(toRemove))},this.moveDataRow=function(oldIndex,newIndex){arrayUtility.moveAt(scope.displayedCollection,oldIndex,newIndex)},this.updateDataRow=function(dataRow,propertyName,newValue){var index=scope.displayedCollection.indexOf(dataRow),getter=parse(propertyName),setter=getter.assign;-1!==index&&getter(scope.displayedCollection[index])!==newValue&&(setter(scope.displayedCollection[index],newValue),scope.$emit("updateDataRow",{item:scope.displayedCollection[index]}))},this.deleteRow=function(dataRow){dataRow.remove().then(function(){var index=scope.displayedCollection.indexOf(dataRow);self.removeDataRow(index),scope.deletingRows=1,self.updateTable()})},this.deleteRows=function(dataRows){var count=dataRows.length;angular.forEach(dataRows,function(dataRow){dataRow.remove().then(function(){var index=scope.displayedCollection.indexOf(dataRow);self.removeDataRow(index),0===--count&&(scope.deletingRows=dataRows.length,self.updateTable())})})}}])}(angular),function(angular){"use strict";angular.module("smartTable.utilities",[]).factory("ArrayUtility",function(){return{removeAt:function(arrayRef,index){if(0<=index&&index<arrayRef.length)return arrayRef.splice(index,1)[0]},insertAt:function(arrayRef,index,item){0<=index&&index<arrayRef.length?arrayRef.splice(index,0,item):arrayRef.push(item)},moveAt:function(arrayRef,oldIndex,newIndex){var elementToMove;0<=oldIndex&&oldIndex<arrayRef.length&&0<=newIndex&&newIndex<arrayRef.length&&(elementToMove=arrayRef.splice(oldIndex,1)[0],arrayRef.splice(newIndex,0,elementToMove))},sort:function(arrayRef,sortAlgorithm,predicate,reverse){return sortAlgorithm&&angular.isFunction(sortAlgorithm)?sortAlgorithm(arrayRef,predicate,!0===reverse):arrayRef},filter:function(arrayRef,filterAlgorithm,predicate){return filterAlgorithm&&angular.isFunction(filterAlgorithm)?filterAlgorithm(arrayRef,predicate):arrayRef},fromTo:function(arrayRef,min,length){var limit,start,out=[];if(!angular.isArray(arrayRef))return arrayRef;start=Math.max(min,0),start=Math.min(start,0<arrayRef.length-1?arrayRef.length-1:0),length=Math.max(0,length),limit=Math.min(start+length,arrayRef.length);for(var i=start;i<limit;i++)out.push(arrayRef[i]);return out}}}),angular.module("ui.bootstrap.pagination.smartTable",[]).constant("paginationConfig",{boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"<",nextText:">",lastText:"Last"}).directive("paginationSmartTable",["paginationConfig","$timeout",function(paginationConfig,$timeout){return{restrict:"EA",require:"^smartTable",scope:{numPages:"=",currentPage:"=",maxSize:"="},templateUrl:"../ambassador/templates/table/table.pagination.html",replace:!0,link:function(scope,element,attrs,ctrl){var boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$eval(attrs.boundaryLinks):paginationConfig.boundaryLinks,directionLinks=angular.isDefined(attrs.directionLinks)?scope.$eval(attrs.directionLinks):paginationConfig.directionLinks,firstText=angular.isDefined(attrs.firstText)?attrs.firstText:paginationConfig.firstText,previousText=angular.isDefined(attrs.previousText)?attrs.previousText:paginationConfig.previousText,nextText=angular.isDefined(attrs.nextText)?attrs.nextText:paginationConfig.nextText,lastText=angular.isDefined(attrs.lastText)?attrs.lastText:paginationConfig.lastText;function makePage(number,text,isActive,isDisabled,prevNext,prevNextAltText){return{number:number,text:prevNext?text:"Page "+text,altText:prevNext?prevNextAltText:text,active:isActive,disabled:isDisabled}}scope.$on("UPDATE_PAGINATION",function(){$timeout(function(){!function(){scope.pages=[];var startPage=1,endPage=scope.numPages;scope.maxSize&&scope.maxSize<scope.numPages&&(startPage=Math.max(scope.currentPage-Math.floor(scope.maxSize/2),1),(endPage=startPage+scope.maxSize-1)>scope.numPages&&(endPage=scope.numPages,startPage=endPage-scope.maxSize+1));for(var number=startPage;number<=endPage;number++){var page=makePage(number,number,scope.isActive(number),!1);scope.pages.push(page)}if(directionLinks){var previousPage=makePage(scope.currentPage-1,previousText,!1,scope.noPrevious(),!0,"<");scope.pages.unshift(previousPage);var nextPage=makePage(scope.currentPage+1,nextText,!1,scope.noNext(),!0,">");scope.pages.push(nextPage)}if(boundaryLinks){var firstPage=makePage(1,firstText,!1,scope.noPrevious());scope.pages.unshift(firstPage);var lastPage=makePage(scope.numPages,lastText,!1,scope.noNext());scope.pages.push(lastPage)}scope.currentPage>scope.numPages&&scope.selectPage(scope.numPages)}((scope.numPages,scope.currentPage,scope.maxSize))})}),scope.noPrevious=function(){return 1===scope.currentPage},scope.noNext=function(){return scope.currentPage===scope.numPages},scope.isActive=function(page){return scope.currentPage===page},scope.selectPage=function(page){!scope.isActive(page)&&0<page&&page<=scope.numPages&&(scope.currentPage=page,ctrl.changePage({page:page}))}}}}]),angular.module("ambassador.table.filters",[]).directive("tableFilterSelect",["$api","$errors","$filter","$timeout","uibDateParser",function($api,$errors,$filter,$timeout,uibDateParser){return{restrict:"E",scope:{filters:"=",config:"=",currency:"=",filterSetType:"@",filtersId:"=?",savedFilters:"=?",updateFilters:"&",tableEmpty:"=",dropdownLabel:"@"},controller:"tableFilterCtrl",templateUrl:"../ambassador/templates/table/table.filter-select.html",link:function(scope,elm,attrs,ctrl){function Filter(config){this.label=config.label,this.param=config.param,this.param_val=null,this.val_label_prefix=config.displayParamPrefix,this.val_label=config.displayParam,angular.isDefined(config.filterFunc)&&(this.filterFunc=config.filterFunc)}scope.currencySymbol={USD:"$",GBP:"£",SGD:"S$",EUR:"€",AUD:"A$",ZAR:"R",BRL:"R$",CAD:"C$",NZD:"NZ$",CHF:"Fr. ",MXN:"Mex$ ",CLP:"$"}[scope.currency],scope.datepickerConfig={isOpen:!0},scope.filterSelect={isOpen:!1},scope.selectFilter=function(filter){scope.filterValueError=!1,scope.focusInput=!1,"typeahead"===filter.template&&(scope.useDropdown=filter.useDropdown,filter.useDropdown?scope.typeaheadData=filter.data:scope.typeaheadData=[]),"calendar"===filter.template&&(scope.datepickerConfig.isOpen=!0),scope.selectedFilter=filter,scope.$broadcast("FILTER_SELECTED")},scope.selectOption=function(value){scope.filterValue=value,scope.addFilter(scope.selectedFilter,scope.filterValue)},scope.checkDate=function(filter,value){var format=void 0!==scope.activeFilter.config.format?scope.activeFilter.config.format:"MM-dd-yyyy";$timeout(function(){void 0!==uibDateParser.parse(elm.find("input")[0].value,format)&&scope.addFilter(filter,value)},0)},scope.addFilter=function(filter,value){var newFilter;if(""!==scope.filterValue&&(value=scope.filterValue),""!==value&&!function(newFilter){angular.forEach(scope.filters,function(filter){if(filter.template===newFilter.template)return!0})}(filter)){if(newFilter=new Filter(filter),"calendar"===filter.template)newFilter.param_val=$filter("date")(value,"yyyy-MM-dd"),newFilter.val_label=$filter("date")(value,scope.activeFilter.config.format?scope.activeFilter.config.format:"MM-dd-yyyy");else if("number"===filter.template||"money"===filter.template){var v=value.replace(/[\,]/g,"");_.isNumber(+v)&&!_.isNaN(+v)?(scope.filterValueError=!1,scope.focusInput=!1,newFilter.param_val=v,newFilter.val_label=("money"===filter.template?scope.currencySymbol:"")+$filter("number")(v,2)):(scope.filterValueError=!0,scope.focusInput=!0)}else"text"===filter.template?(newFilter.param_val=value,newFilter.val_label=value):void 0!==filter.options?(newFilter.param_val=value.value,newFilter.val_label=value.label):(newFilter.param_val=void 0!==filter.async.param?value[filter.async.param]:value[newFilter.param],newFilter.val_label=newFilter.val_label_prefix?value[newFilter.val_label_prefix]+" - "+value[newFilter.val_label]:value[newFilter.val_label]);scope.filterValueError||(scope.$emit("FILTERS_CHANGED"),scope.filters.push(newFilter),scope.updateFilters(),scope.selectedFilter="",scope.$broadcast("FILTER_SELECTED"),scope.filterSelect.isOpen=!1)}},scope.clearAll=function(){scope.filters.length=0,scope.$emit("FILTERS_CHANGED"),scope.filterSelect.isOpen=!1,scope.updateFilters()},scope.resetFilter=function(){scope.selectedFilter="",scope.$broadcast("FILTER_SELECTED")},scope.filterSelected=function(item){if(0===scope.filters.length)return item;for(var found=!0,i=0;i<scope.filters.length;i++){if(item.label===scope.filters[i].label){found=!0;break}found=!1}return found?void 0:item},void 0!==scope.config&&(ctrl.setConfig(scope.config),0<scope.filters.length&&angular.forEach(scope.filters,function(filter){scope.filterSelected(filter)}))}}}]).directive("tableFilterActive",[function(){return{restrict:"E",scope:{filters:"=",updateFilters:"&",search:"=",updateSearch:"&"},controller:"tableFilterCtrl",templateUrl:"../ambassador/templates/table/table.filter-active.html",link:function(scope,elm,attrs,ctrl){scope.removeFilter=function(filter){scope.filters=_.without(scope.filters,filter),scope.updateFilters({newFilters:scope.filters})},scope.clearSearch=function(){scope.search="",scope.updateSearch()}}}}]).directive("tableFilterInput",["$compile","$timeout",function($compile,$timeout){return{restrict:"E",require:"^tableFilterSelect",link:function(scope,elm,attrs,ctrl){var templates={text:'<div class="input-group"><input ng-model="filterValue" ga-enter="addFilter(selectedFilter, filterValue)" class="form-control" type="text"><span class="input-group-btn"><button ng-click="addFilter(selectedFilter, filterValue)" class="btn btn-default" type="button"><i class="fa fa-plus"></i></button></span></div>',select:'<div class="dropdown" uib-dropdown is-open=applyAction.isOpen><a class="dropdown-toggle btn btn-default" uib-dropdown-toggle> Select an option<i class="caret"></i></a><ul class="dropdown-menu" uib-dropdown-menu><li ng-repeat="o in activeFilter.options"><a ng-click="selectOption(o)">{{o.label}}</a></li></ul></div>',number:'<div class="input-group" ng-class="{\'has-error\': filterValueError}"><input ng-model="filterValue" ga-enter="addFilter(selectedFilter, filterValue)" class="form-control" type="text"><span class="input-group-btn"><button ng-click="addFilter(selectedFilter, filterValue)" class="btn btn-default" type="button"><i class="fa fa-plus"></i></button></span></div>',money:'<div class="input-group input-money" ng-class="{\'has-error\': filterValueError}"><span class="input-group-addon">{{currencySymbol}}</span><input ng-model="filterValue" ga-enter="addFilter(selectedFilter, filterValue)" type="text" class="form-control"><span class="input-group-btn"><button ng-click="addFilter(selectedFilter, filterValue)" class="btn btn-default" type="button"><i class="fa fa-plus"></i></button></span></div>',typeahead:'<div><div ng-if="!useDropdown" class="async-loader"><input type="text" ng-model="filterValue" placeholder="Search {{activeFilter.async.endpoint}}" uib-typeahead="o as o[activeFilter.async.field] for o in asyncSearch($viewValue) | limitTo:15" typeahead-loading="async.loadingResults" | typeahead-wait-ms="async.asyncWaitTime" typeahead-template-url="../ambassador/templates/table/table.typeahead-filter-template.html" typeahead-on-select="addFilter(selectedFilter, filterValue)" class="form-control"><i ng-show="async.loadingResults" class="fa fa-refresh fa-spin"></i></div><div ng-if="useDropdown" class="dropdown dropdown-select" uib-dropdown is-open="tyepaheadDropdown.isOpen" ng-init="tyepaheadDropdown.isOpen = true"><a class="dropdown-toggle btn btn-default" uib-dropdown-toggle>Select {{activeFilter.async.endpoint}} <i class="caret"></i></a><ul class="dropdown-menu" uib-dropdown-menu><li ng-repeat="o in typeaheadData"  ng-if="typeaheadData.length > 0"><a ng-click="addFilter(selectedFilter, o)"><span ng-if="activeFilter.async.displayPrefix !== undefined">{{o[activeFilter.async.displayPrefix]}} - </span>{{o[activeFilter.async.field]}}</a></li><li ng-if="typeaheadData.length === 0"><a ng-if="activeFilter.noItems !== undefined && !activeFilter.noItems.callback" ng-click="resetFilter()"><span ng-if="activeFilter.noItems.text !== undefined">{{activeFilter.noItems.text}}</span><span ng-if="!activeFilter.noItems.text">No {{activeFilter.async.endpoint}} to select</span></a><a ng-if="activeFilter.noItems !== undefined && activeFilter.noItems.callback !== undefined" ng-click="callbackFunction()"><span ng-if="activeFilter.noItems.text !== undefined">{{activeFilter.noItems.text}}</span><span ng-if="!activeFilter.noItems.text">No {{activeFilter.async.endpoint}} to select</span></a></li></ul></div></div>',calendar:'<div class="datepicker-field"><input type="text" class="form-control" ng-change="checkDate(selectedFilter, filterValue)" placeholder="{{activeFilter.config.format.toLowerCase() || \'mm-dd-yyyy\'}}" uib-datepicker-popup="{{activeFilter.config.format || \'MM-dd-yyyy\'}}" uib-datepicker-popup datepicker-options="{showWeeks: false}" is-open="datepickerConfig.isOpen" ng-click="datepickerConfig.isOpen = true;" show-button-bar="false" ng-model="filterValue" min-date="activeFilter.config.minDate" max-date="activeFilter.config.maxDate" /></div>'};function compileInput(filterTemp){filterTemp?elm.html(templates[filterTemp]):elm.html(""),$compile(elm.contents())(scope)}scope.$on("FILTER_SELECTED",function(){var filter;""===(filter=scope.selectedFilter)?(compileInput(),scope.filterValue=""):(compileInput((scope.activeFilter=filter).template),"text"!==filter.template&&"number"!==filter.template&&"money"!==filter.template||$timeout(function(){elm.find("input")[0].focus()}),"typeahead"===filter.template&&(filter.useDropdown||$timeout(function(){elm.find("input")[0].focus()})))}),scope.$watch("focusInput",function(focus){$timeout(function(){focus&&scope.filterValueError&&(elm.find("input")[0].focus(),scope.focusInput=!1)})}),scope.callbackFunction=function(){console.log("No results?"),scope.activeFilter.noItems.callback(),scope.resetFilter()}}}}]).controller("tableFilterCtrl",["$scope","$api","$q",function($scope,$api,$q){var abortSearch;$scope.selectedFilter="",$scope.filterValue="",$scope.async={loadingResults:!1,asyncWaitTime:500},$scope.activeFilter={},$scope.filterOptions=[],this.setConfig=function(config){angular.forEach(config,function(filter){"typeahead"===filter.template&&$scope.getData(filter),$scope.filterOptions.push(filter)})},$scope.getData=function(filter){$api.use("default").all(filter.async.endpoint).getList({page_size:25}).then(function(data){data.count<=25?(filter.data=data,filter.useDropdown=!0):filter.useDropdown=!1})},$scope.asyncSearch=function(value){return abortSearch&&abortSearch.resolve(),abortSearch=$q.defer(),$scope.async.loadingResults=!0,$api.use("default").all($scope.activeFilter.async.endpoint).withHttpConfig({timeout:abortSearch.promise}).getList({search:value,ordering:$scope.activeFilter.async.field}).then(function(data){return $scope.async.loadingResults=!1,data})}}])}(angular);