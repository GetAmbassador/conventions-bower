angular.module("ngAmbassador.forms",["ngAmbassador.constants","colorpicker.module","toggle-switch","ngAmbassador.services","ngAmbassador.api"]).factory("$validationUtilities",["$q","$api",function($q,$api){return{doesAmbassadorEmailExist:function(value,originalValue){var deferred=$q.defer();return value===originalValue?deferred.resolve():$api.use("default").all("ambassadors").getList({email:value}).then(function(data){data.count>=1&&value!==originalValue?deferred.reject("This email address already exists."):deferred.resolve()}),deferred.promise},doesTeamMemberExist:function(value,originalValue){var deferred=$q.defer();return value===originalValue?deferred.resolve():$api.use("default").all("team").getList({email:value}).then(function(data){data.count>=1&&value!==originalValue?deferred.reject("Email address is already in use by another user."):deferred.resolve()}),deferred.promise},dropdownItemSelected:function(value){var deferred=$q.defer();return void 0===value?deferred.reject("You must make a selection."):deferred.resolve(),deferred.promise},gaSelectItemSelected:function(value,originalValue,multi){function isEmptyObject(obj){var key;for(key in obj)return!1;return!0}var deferred=$q.defer();return 0===value.length||isEmptyObject(value)?deferred.reject("You must make a selection."):deferred.resolve(),deferred.promise},isInteger:function(value){var deferred=$q.defer(),integer_regex=/^-?\d+$/;return integer_regex.test(value.trim())?deferred.resolve():deferred.reject("Invalid number.  Please enter a whole number."),deferred.promise},isIntegerOrFloat:function(value){var deferred=$q.defer(),float_regex=/^-?\d+\.?\d+?$/,integer_regex=/^-?\d+$/;return float_regex.test(value.trim())||integer_regex.test(value.trim())?deferred.resolve():deferred.reject("Invalid format.  Please enter a whole or decimal number."),deferred.promise},isLessThanMaxLength:function(value,originalValue,additionalParams){var deferred=$q.defer();return value.length>additionalParams.maxLength?deferred.reject("You may only use up to "+additionalParams.maxLength+" characters."):deferred.resolve(),deferred.promise},isLessThanMaxNumber:function(value,originalValue,additionalParams){var deferred=$q.defer(),dollarValue=parseInt(value,10);return dollarValue>additionalParams.maxNumber?deferred.reject("Number cannot be larger than "+additionalParams.maxNumber+"."):deferred.resolve(),deferred.promise},isAtLeastMinLength:function(value,originalValue,additionalParams){var deferred=$q.defer();return value.length<additionalParams.minLength?deferred.reject("Input must be at least "+additionalParams.minLength+" characters."):deferred.resolve(),deferred.promise},isNotEmpty:function(value){var deferred=$q.defer();return value.toString().trim().length>0?deferred.resolve():deferred.reject("The field must not be empty."),deferred.promise},isEqualTo:function(value,originalValue,additionalParams){var deferred=$q.defer();return void 0!==additionalParams.comparison&&value.toString()===additionalParams.comparison.toString()?deferred.resolve():deferred.reject("The passwords do not match."),deferred.promise},isRequiredIf:function(value,originalValue,additionalParams){var deferred=$q.defer();return void 0===additionalParams.parentField||0===additionalParams.parentField.toString().length||additionalParams.parentField.toString().length>0&&value.toString().length>0?deferred.resolve():deferred.reject("This field is required."),deferred.promise},isNotFutureDate:function(date){var deferred=$q.defer(),today=new Date,dateInFuture=!1;if(date instanceof Array)for(var i=0;i<date.length;i++){if(new Date(date[i]).setHours(0,0,0,0)>today.setHours(0,0,0,0)){deferred.reject(),dateInFuture=!0;break}i!==date.length-1||dateInFuture||deferred.resolve()}else new Date(date).setHours(0,0,0,0)>today.setHours(0,0,0,0)?deferred.reject():deferred.resolve();return deferred.promise},isValidCreditCard:function(value,originalValue){var deferred=$q.defer();if(value===originalValue)deferred.resolve();else{/[^0-9-\s]+/.test(value.trim())&&deferred.reject("Invalid credit card number.");var nCheck=0,nDigit=0,bEven=!1;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);nDigit=parseInt(cDigit,10),bEven&&(nDigit*=2)>9&&(nDigit-=9),nCheck+=nDigit,bEven=!bEven}nCheck%10===0?deferred.resolve():deferred.reject("Invalid credit card number.")}return deferred.promise},isValidEmail:function(value){var deferred=$q.defer(),re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(value.trim())?deferred.resolve():deferred.reject("Invalid email address."),deferred.promise},isValidUrl:function(value){var deferred=$q.defer(),re=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return re.test(value.trim())?deferred.resolve():deferred.reject('Invalid url.  Please use the format "http(s)://url.com".'),deferred.promise},isValidUrlWithoutProtocol:function(value){var deferred=$q.defer(),re=/^(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return re.test(value.trim())?deferred.resolve():deferred.reject('Invalid url.  Please use the format "url.com or subdomain.url.com".'),deferred.promise},isValidUrlWithSubdomain:function(value){var deferred=$q.defer(),re=/^(?!\-)(?:[a-zA-Z\d\-]{0,62}[a-zA-Z\d]\.){2,126}(?!\d+)[a-zA-Z\d]{1,63}$/i;return re.test(value.trim())?deferred.resolve():deferred.reject('Invalid url. The url must contain a subdomain. Please use the format "subdomain.url.com".'),deferred.promise},isUrl:function(value){var deferred=$q.defer(),withProtocol=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,withoutProtocol=/^(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;return withProtocol.test(value.trim())||withoutProtocol.test(value.trim())?deferred.resolve():deferred.reject("Invalid url."),deferred.promise},isZipCode:function(value){var deferred=$q.defer(),re=/^\d{5}([\-]?\d{4})?$/;return re.test(value.trim())?deferred.resolve():deferred.reject("Invalid zip code.  Please follow the XXXXX-XXXX format (with last 4 digits optional)."),deferred.promise},validDollarAmount:function(value,originalValue){var deferred=$q.defer(),currency_regex=/^-?\d{1,6}\.?\d{1,2}?$/,integer_regex=/^-?\d+$/;return currency_regex.test(value.trim())||integer_regex.test(value.trim())?deferred.resolve():deferred.reject("Invalid format.  Please enter a whole number, or a number in the format 'xx.xx'."),deferred.promise},validEmailOrShortcode:function(value,originalValue){var deferred=$q.defer(),error_message="",re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,search_object={},key=re.test(value.trim())?"email":"short_code";return search_object[key]=value,error_message="email"===key?"Referring ambassador with this email does not exist.":"Short code does not exist or the email is incomplete.",$api.use("default").all("ambassadors").getList(search_object).then(function(data){0===data.count?deferred.reject(error_message):deferred.resolve()},function(error){deferred.reject(error_message)}),deferred.promise},containsTags:function(value,originalValue,additionalParams){var deferred=$q.defer(),tagsContained=0,missingTags=[];return angular.forEach(additionalParams.requiredTags,function(tag){value.indexOf("{"+tag+"}")>-1?tagsContained++:missingTags.push("{"+tag+"}")}),tagsContained===additionalParams.requiredTags.length?deferred.resolve():deferred.reject("Not all required tags are present. Missing tags: "+missingTags.join(", ")),deferred.promise}}}]).directive("gaFormField",["$q","$timeout","$compile","$helper",function($q,$timeout,$compile,$helper){return{restrict:"E",replace:!0,scope:{isDisabled:"=?",isReadonly:"=?",extraClasses:"@",fieldType:"@?",helpText:"@?",label:"@?",defaultDropdownText:"@?",model:"=?",modelValue:"@",modelText:"@",showModelValue:"=?",additionalParams:"=?",callbackFunction:"&",options:"=?",pristine:"=",isRequired:"@?",isRequiredIf:"=?",isRequiredIfField:"=?",requiredText:"@?",rules:"=?",equalTo:"=?",stateClasses:"=?",validatedField:"=",validationThreshold:"@?",validationWait:"@?",showPasswordStrength:"@?",placeholder:"@?",showAsterisks:"=",trim:"@?",errorMessage:"=?",loading:"=?",radioConfig:"=?",isFocused:"=?"},link:function(scope,element,attrs,ctrl){function get_template(){var disabledString=void 0!==scope.isDisabled?"ng-disabled='disableField'":"",readonlyString=void 0!==scope.isReadonly?"ng-readonly='readonlyField'":"",trueValueString="undefined"!=typeof scope.additionalParams&&"undefined"!=typeof scope.additionalParams.trueValue?' ng-true-value="{{additionalParams.trueValue}}"':"",falseValueString="undefined"!=typeof scope.additionalParams&&"undefined"!=typeof scope.additionalParams.falseValue?' ng-false-value="{{additionalParams.falseValue}}"':"",colorpickerString="colorpicker"===scope.fieldType?" colorpicker ":"";colorpickerString+=void 0!==scope.additionalParams&&void 0!==scope.additionalParams.appendToParent&&scope.additionalParams.appendToParent===!1?"":'colorpicker-parent="true" ';var colorPreviewString='<div class=\'color-preview\' ng-style=\'{"background-color": model || "#ffffff", "border-color": colorPreviewBorderColor || "#e1e1e1"}\'></div>',caretChevronClass=attrs.hasOwnProperty("appearance")&&"snippet"===attrs.appearance?"fa fa-chevron-down":"caret",errorIcon=attrs.hasOwnProperty("appearance")&&"snippet"===attrs.appearance?"fa-exclamation-triangle":"fa-exclamation",calendarIcon=attrs.hasOwnProperty("appearance")&&"snippet"===attrs.appearance?"fa fa-calendar":"glyphicon glyphicon-calendar",autoExpandString="undefined"!=typeof scope.additionalParams&&"undefined"!=typeof scope.additionalParams.textExpand&&scope.additionalParams.textExpand===!0?" expand-textarea ":"",focusString="undefined"!=typeof scope.isFocused?' ng-blur="isFocused = false;"':"",snippetAppearance="";if(attrs.hasOwnProperty("appearance")&&"snippet"===attrs.appearance)var snippetAppearance="snippet";var input_template="<div class='inner-field-wrapper {{ extraClasses }}' ng-class='{\"inner-field-loading\":loading}'>  <input ng-trim='{{trimValue}}' ng-model='model' placeholder='{{ placeholder }}' class='form-control' type='text' "+disabledString+readonlyString+colorpickerString+focusString+">"+colorPreviewString+"  <i ng-show=\"state=='working' || loading\" class='fa fa-refresh fa-spin'></i>  <i ng-show=\"state=='success'\" class='fa fa-check'></i>  <i ng-show=\"state=='error'\" class='fa "+errorIcon+"'></i></div><span class='help-block'>{{ helpText }}</span>",textarea_template="<div class='inner-field-wrapper {{ extraClasses }}'>  <textarea ng-model='model' class='form-control'"+autoExpandString+disabledString+readonlyString+" placeholder='{{ placeholder }}'></textarea></div><span class='help-block'>{{ helpText }}</span>",redactor_template='<div class=\'inner-field-wrapper {{ extraClasses }}\'>  <div class="redactor-disabled-overlay" ng-if="isDisabled"></div>  <textarea ng-hide="!redactorLoaded" ng-model="model" ga-redactor="redactorConfig" placeholder="{{ placeholder }}"></textarea></div><span class=\'help-block\'>{{ helpText }}</span>',select_template="";if(scope.options){if(scope.dropdown={isOpen:!1},"simple-select"===scope.fieldType){var model_value=scope.modelValue?scope.modelValue:"value",model_text=scope.modelText?scope.modelText:"text";select_template="<div class='inner-field-wrapper {{ extraClasses }}'>  <div class='dropdown dropdown-select dropdown-form' is-open='dropdown.isOpen' ng-class='{disabled: isDisabled}'>    <a class='dropdown-toggle btn btn-default' "+disabledString+">      <span ng-if='defaultDropdownText && !model'>{{defaultDropdownText}}</span>      <span ng-if='showModelValue && model'>{{model."+model_value+"}} - </span>{{model."+model_text+"}} <span class='"+caretChevronClass+"'></span>    </a>    <ul class='dropdown-menu'>      <li ng-repeat='o in options'>        <a ng-click='selectItem(o, true)'><span ng-if='showModelValue'>{{o."+model_value+"}} - </span>{{o."+model_text+"}}</a>      </li>    </ul>  </div></div>"}else select_template="<div class='inner-field-wrapper {{ extraClasses }}'>  <div class='dropdown dropdown-select dropdown-form' is-open='dropdown.isOpen' ng-class='{disabled: isDisabled}'>    <a class='dropdown-toggle btn btn-default' "+disabledString+">      {{modelLabel || defaultDropdownText || 'Select one'}} <span class='"+caretChevronClass+"'></span>    </a>    <ul class='dropdown-menu'>      <li ng-repeat='o in options'>        <a ng-click='selectItem(o, false)'>{{o.name}}</a>      </li>    </ul>  </div></div>";select_template+="<span class='help-block'>{{ helpText }}</span>"}var gaselect_template="<div class='inner-field-wrapper {{ extraClasses }}'>  <ga-select model='model' endpoint='{{additionalParams.config.endpoint}}' comparator='{{additionalParams.config.comparator}}' is-disabled='isDisabled' data='additionalParams.config.data' multi='{{additionalParams.config.multi}}' placeholder='{{additionalParams.config.placeholder}}' label='{{additionalParams.config.label}}' display-selected-as = '{{additionalParams.config.displaySelectedAs}}' position = '{{additionalParams.config.position}}' appearance ="+snippetAppearance+"></ga-select></div><span class='help-block'>{{ helpText }}</span>",checkbox_template="<div class='form-group checkbox-group no-label'>  <div class='inner-field-wrapper {{ extraClasses }}'>    <div class='input-group'>      <span class='input-group-addon' ng-class='{disabled: isDisabled}'><div><input ng-model='model' id='"+scope.$id+"' "+disabledString+trueValueString+falseValueString+" type='checkbox' ng-change='callback(model)'><label for='"+scope.$id+"'></label></div></span>      <label class='form-control' "+disabledString+" for='"+scope.$id+"'>"+scope.label+"<span ng-if='showAsterisks!==false'>{{labelSuffix}}</span></label>    </div>  </div>  <span class='help-block'>{{ helpText }}</span></div>",password_template="<div class='inner-field-wrapper {{ extraClasses }}'>  <input ng-model='model' class='form-control' "+disabledString+" type='password' placeholder='{{ placeholder }}'>";"true"===scope.showPasswordStrength&&(password_template+="<span ga-password-strength='model' id='password-strength' class='label label-input'></span>"),password_template+="</div><span class='help-block'>{{ helpText }}</span>";var password_conf_template="<div class='inner-field-wrapper {{ extraClasses }}'>  <input ng-model='model' class='form-control' "+disabledString+" type='password' placeholder='{{ placeholder }}'>  <i ng-show='state==\"working\"' class='fa fa-refresh fa-spin'></i>  <i ng-show='state==\"success\"' class='fa fa-check'></i>  <i ng-show='state==\"error\"' class='fa "+errorIcon+"'></i></div><span class='help-block'>{{ helpText }}</span>",datepicker_template="<div class='inner-field-wrapper datepicker-field {{ extraClasses }}'>";scope.additionalParams&&scope.additionalParams.calendarButton&&(datepicker_template+="<div class='input-group'>"),datepicker_template+="<input type='text' "+disabledString+" class='form-control' placeholder='{{ placeholder }}' datepicker-popup='{{additionalParams.format || \"MM-dd-yyyy\"}}' datepicker-options='additionalParams.dateOptions' is-open='additionalParams.isOpen' ng-click='toggleDatepicker($event, true)' show-button-bar='false' ng-model='model' min-date='additionalParams.minDate' max-date='additionalParams.maxDate' />",scope.additionalParams&&scope.additionalParams.calendarButton&&(datepicker_template+="    <span class='input-group-btn'>      <button type='button' "+disabledString+" class='btn btn-default' ng-click='toggleDatepicker($event)'><i class='"+calendarIcon+"'></i></button>    </span>  </div>"),datepicker_template+="</div><span class='help-block'>{{ helpText }}</span>",radio_template="<div class='mbsy-radio-group'>  <label class='mbsy-radio' ng-class='{disabled: isDisabled}' ng-repeat='radio in radioConfig.buttons' for='{{radio.id}}'>    <input "+disabledString+"      type='radio'      ng-model='$parent.model'      ng-change='radioChange(radio.value)'      ng-value='radio.value'      name='{{radioConfig.name}}'      id='{{radio.id}}'/>      <span>{{radio.label}}</span>  </label></div><span class='help-block'>{{ helpText }}</span>";var template="<div class='form-group'>  <label ng-if='label'>"+scope.label+"<span ng-if='showAsterisks!==false'>{{labelSuffix}}</span></label>  <div class='async-loader'>";return"textarea"===scope.fieldType?template+=textarea_template:"ga-redactor"===scope.fieldType?template+=redactor_template:"select"===scope.fieldType||"simple-select"===scope.fieldType?template+=select_template:"ga-select"===scope.fieldType?template+=gaselect_template:"password"===scope.fieldType?template+=password_template:"date"===scope.fieldType?("undefined"!=typeof scope.additionalParams.dateOptions?scope.additionalParams.dateOptions.showWeeks=!1:scope.additionalParams.dateOptions={showWeeks:!1},template+=datepicker_template):"checkbox"===scope.fieldType?template=checkbox_template:"password-conf"===scope.fieldType?(scope.$watch("equalTo",function(value){scope.additionalParams={comparison:scope.equalTo},value&&scope.model&&(scope.model="",validate("change"))}),template+=password_conf_template):template+="radio"===scope.fieldType?radio_template:input_template,void 0!==scope.isRequiredIf&&scope.$watch("isRequiredIfField",function(value){if(value)scope.labelSuffix="*",scope.validatedField=!1,required=!0;else{scope.labelSuffix="",scope.validatedField=!0,required=!1;for(var key in scope.stateClasses)element.removeClass(scope.stateClasses[key]),labelElement.removeClass(scope.stateClasses[key]);scope.state="",scope.helpText=void 0===originalHelpText?"":originalHelpText}scope.additionalParams={parentField:value}}),"checkbox"!==scope.fieldType&&(template+="  </div></div>"),template}function getTypeLabel(type){angular.forEach(scope.options,function(commissionType){type===commissionType.value&&(scope.modelLabel=commissionType.name)}),angular.isUndefined(scope.modelLabel)&&(scope.modelLabel="Select one")}function get_field_type(){return"password"!==scope.fieldType&&"password-conf"!==scope.fieldType&&scope.fieldType?element.find(scope.fieldType):element.find("input")}function bind_events(){function waitForDirective(){0===element.find("input").length?$timeout(function(){waitForDirective()},500):typeaheadBinding()}function typeaheadBinding(){element.find("input").bind("blur",function(){function validateOnBlur(){0===element.find("ul").length?validate("blur"):$timeout(function(){validateOnBlur()},50)}validateOnBlur()}),element.find("input").bind("focus",function(){fieldPristine&&(originalValue=angular.copy(scope.model),fieldPristine=!1)})}("select"===scope.fieldType||"simple-select"===scope.fieldType)&&inputElement.bind("change",validate),"ga-select"!==scope.fieldType?(inputElement.bind("blur keyup",function(evt){if(timer&&$timeout.cancel(timer),"blur"===evt.type)validate(evt);else if(9!==evt.keyCode){var validationWait=1500;void 0!==scope.validationWait&&(validationWait=parseInt(scope.validationWait,10)),timer=$timeout(function(){(""!==inputElement[0].value||required===!0)&&validate(evt)},validationWait)}}),inputElement.bind("focus",function(){fieldPristine&&(originalValue=angular.copy(scope.model),fieldPristine=!1)})):(!scope.additionalParams.config.data||scope.additionalParams.config.data.length>=25)&&waitForDirective()}function handle_error(error){$timeout(function(){scope.state="error",scope.helpText=void 0!==scope.additionalParams&&void 0!==scope.additionalParams.errorMessage?scope.additionalParams.errorMessage:error,scope.validatedField=!1,element.addClass(scope.stateClasses.error),labelElement.addClass(scope.stateClasses.error)})}function initialize(){if(void 0===scope.stateClasses)scope.stateClasses=defaultStateClasses;else for(var key in defaultStateClasses)scope.stateClasses.hasOwnProperty(key)||(scope.stateClasses[key]=defaultStateClasses[key]);scope.validationThreshold=void 0===scope.validationThreshold?1:parseInt(scope.validationThreshold,10),required="true"===scope.isRequired?!0:!1}function success(){scope.state="success",scope.helpText=originalHelpText,element.removeClass(scope.stateClasses.error),scope.validatedField=!0,element.addClass(scope.stateClasses.success),labelElement.removeClass(scope.stateClasses.error)}function getValue(evt){var value=null;if("select"===scope.fieldType||"ga-select"===scope.fieldType||"radio"===scope.fieldType||"ga-redactor"===scope.fieldType)value=scope.model;else if("simple-select"===scope.fieldType)value="undefined"==typeof scope.model||""===scope.model?"":scope.modelText?scope.model[scope.modelText]:scope.model.name;else if(void 0!==evt.target)try{value=evt.srcElement.value}catch(e){value=evt.target.value}else value=scope.model;return value}function validate(evt){if(scope.rules.length>0){var value=null,result=null,first=!0;value=getValue(evt),scope.validatedField=!0,scope.pristine=!1,required===!0&&angular.isDefined(value)&&(""===value||"function"==typeof value.trim&&0===value.trim().length||value===!1&&"radio"!==scope.fieldType||"ga-select"===scope.fieldType&&_.isEmpty(value))?handle_error(scope.requiredText?scope.requiredText:"This field is required."):""!==value&&scope.rules.length>0?(scope.state="working",("change"===evt.type||"blur"===evt.type||void 0!==value&&value.toString().length>=scope.validationThreshold||void 0!==value)&&(angular.forEach(scope.rules,function(validation_function,key){first?(result=validation_function(value,originalValue,scope.additionalParams),first=!1):result=result.then(function(){return validation_function(value,originalValue,scope.additionalParams)})}),scope.rules.length>0&&result.then(success,handle_error))):(scope.clearValidationErrors(),scope.$$phase||"checkbox"===scope.fieldType||$timeout(function(){scope.$apply()},0))}else{var value=getValue(evt);required===!0&&angular.isDefined(value)&&(""===value||"function"==typeof value.trim&&0===value.trim().length||value===!1&&"radio"!==scope.fieldType||"ga-select"===scope.fieldType&&_.isEmpty(value))?handle_error(scope.requiredText?scope.requiredText:"This field is required."):required!==!0||angular.isUndefined(value)&&"radio"===scope.fieldType||success()}}if(scope.disableField=!1,angular.isUndefined(scope.rules)&&(scope.rules=[]),scope.$watch("isDisabled",function(){scope.disableField=scope.isDisabled}),scope.$watch("isReadonly",function(){scope.readonlyField=scope.isReadonly}),scope.trimValue="true"===scope.trim?!1:!0,"ga-redactor"===scope.fieldType){var validateRedactor,tagAdded=!1;scope.redactorConfig={blurCallback:function(e){scope.$broadcast("REDACTOR_CHANGE",{event:e.type})}},angular.extend(scope.redactorConfig,scope.additionalParams.redactorConfig),scope.$on("TAG_ADDED",function(event){tagAdded=!0})}scope.$on("REDACTOR_CHANGE",function(event,args){validate(args.event)}),scope.selectItem=function(item,simpleSelect){simpleSelect?scope.model=item:(scope.modelLabel=item.name,scope.model=item.value),scope.dropdown.isOpen=!1,"function"==typeof scope.callbackFunction&&scope.callbackFunction({selected:item}),validate("change")},scope.toggleDatepicker=function($event,openDatepicker){$event.preventDefault(),$event.stopPropagation(),scope.additionalParams.isOpen=openDatepicker?openDatepicker:!scope.additionalParams.isOpen},scope.callback=function(checked){"function"==typeof scope.callbackFunction&&scope.callbackFunction({selected:checked})},scope.radioChange=function(value){"function"==typeof scope.radioConfig.callback&&scope.radioConfig.callback(value)},_.isUndefined(scope.isFocused)||scope.$watch("isFocused",function(newValue,oldValue){if(newValue){var inputElement=get_field_type();inputElement[0].focus()}}),scope.$watch("model",function(newValue,oldValue){if("undefined"==typeof newValue||"string"==typeof newValue||"undefined"==typeof scope.additionalParams||"undefined"==typeof scope.additionalParams.trueValue&&"undefined"==typeof scope.additionalParams.falseValue||(scope.model=scope.model.toString()),"true"===scope.trim&&void 0!==newValue&&(scope.model=newValue.trim()),void 0!==scope.additionalParams&&scope.additionalParams.config&&newValue!==oldValue&&$timeout(function(){validate("change")},0),("checkbox"===scope.fieldType&&newValue!==oldValue||"date"===scope.fieldType||"radio"===scope.fieldType)&&validate("change"),angular.isDefined(scope.model)&&"select"===scope.fieldType&&getTypeLabel(scope.model),"colorpicker"===scope.fieldType){var color=scope.model||"#ffffff";scope.colorPreviewBorderColor=$helper.colorLuminance(color,-.2)}if("ga-redactor"===scope.fieldType){var delay=tagAdded?0:1500;void 0!==validateRedactor&&$timeout.cancel(validateRedactor),validateRedactor=$timeout(function(){validate("change"),tagAdded=!1},delay)}scope.errorMessage=""},!0),void 0===scope.fieldType&&(scope.fieldType="input"),"true"===scope.isRequired&&(scope.labelSuffix="*"),element.html(get_template()),$compile(element.contents())(scope);var defaultStateClasses={error:"has-error",success:"has-success",working:"working"},fieldPristine=!0,inputElement=get_field_type(),labelElement=element.find("label"),originalHelpText=scope.helpText,originalValue=fieldPristine&&null!==scope.model?angular.copy(scope.model):"",required=null,timer=null;scope.clearValidationErrors=function(){if("undefined"==typeof scope.errorMessage||""===scope.errorMessage||null===scope.errorMessage){for(var key in scope.stateClasses)element.removeClass(scope.stateClasses[key]),labelElement.removeClass(scope.stateClasses[key]);scope.state="",scope.helpText=void 0===originalHelpText?"":originalHelpText,scope.validatedField=!0}},scope.$watch("errorMessage",function(newValue,oldValue){if(angular.isDefined(scope.errorMessage))if(""!==scope.errorMessage&&void 0!==validateRedactor&&$timeout.cancel(validateRedactor),""!==newValue&&null!==newValue){var errorMsg=angular.isArray(newValue)===!0?newValue[0]:newValue;handle_error(errorMsg)}else{var value=getValue("change");required&&(required&&angular.isDefined(value)&&(""===value||"function"==typeof value.trim&&0===value.trim().length||value===!1)||!angular.isDefined(value))||"ga-select"===scope.fieldType&&_.isEmpty(value)||scope.clearValidationErrors()}}),initialize(),bind_events()}}}]).directive("gaPasswordStrength",[function(){return{replace:!1,restrict:"A",scope:{gaPasswordStrength:"="},link:function(scope,elem,attrs){var strength={text:["Weak","Acceptable","Strong","Very Strong"],classes:["danger","warning","primary","success"],mesureStrength:function(p){for(var _force=0,_regex=/[$-\/:-?{-~!""^_`\[\]]/g,_lowerLetters=/[a-z]+/.test(p),_upperLetters=/[A-Z]+/.test(p),_numbers=/[0-9]+/.test(p),_symbols=_regex.test(p),_flags=[_lowerLetters,_upperLetters,_numbers,_symbols],_passedMatches=0,i=0;i<_flags.length;i++)_flags[i]===!0&&_passedMatches++;return _force+=2*p.length+(p.length>=10?1:0),_force+=10*_passedMatches,_force=p.length<=6?Math.min(_force,10):_force,_force=1===_passedMatches?Math.min(_force,10):_force,_force=2===_passedMatches?Math.min(_force,20):_force,_force=3===_passedMatches?Math.min(_force,40):_force},getColor:function(s){var idx=0;return idx=10>=s?0:20>=s?1:40>=s?2:3,{idx:idx+1,text:this.text[idx],color_class:this.classes[idx]}}};scope.$watch("gaPasswordStrength",function(){if(""===scope.gaPasswordStrength||"undefined"==typeof scope.gaPasswordStrength)elem.css({display:"none"});else{var c=strength.getColor(strength.mesureStrength(scope.gaPasswordStrength));elem.css({display:"inline"}),elem.removeClass("label-danger").removeClass("label-warning").removeClass("label-info").removeClass("label-primary").removeClass("label-success").removeClass("label-warning").addClass("label label-"+c.color_class).text(c.text);
}})}}}]).directive("gaSelect",["$api","$q",function($api,$q){"use strict";return{restrict:"E",scope:{model:"=",data:"=",defaultOption:"=",endpoint:"@",multi:"@",label:"@",placeholder:"@",comparator:"@",resetDisabled:"=",search:"&",isDisabled:"=",property:"@",resultModel:"=",noItemsText:"=?",displaySelectedAs:"@",noItemsCallback:"&?",resultClasses:"=?",allowInputValue:"=?",searchProperties:"=?",sortBy:"@?",filterParams:"=?",maxItemListHeight:"@?",validPattern:"=?",position:"@",appearance:"@"},templateUrl:"../ambassador/templates/directive.chooser.html",replace:!1,link:function(scope,element,attrs){function setBinding(){waitForInputEl(),element.find("input").bind("keydown",function(e){13!==e.keyCode&&element.removeClass("has-error")})}function setClasses(){if(scope.resultClasses){var classes=[];angular.forEach(scope.resultClasses,function(resultClass){classes.push("'"+resultClass["class"]+"':"+(resultClass.negate?"!":"")+(scope.dropdown.isEnabled?"item.":"match.model.")+resultClass.condition)}),scope.classesString="{"+classes.join()+"}"}}function handleEmptyDropdown(show){scope.dropdown.isEnabled&&(show?(scope.noItemsText="undefined"==typeof scope.noItemsText||""===scope.noItemsText||null===scope.noItemsText?"Nothing to select":scope.noItemsText,scope.hideDropdown=!1,scope.showNoItemsMessage=!0):"undefined"==typeof scope.noItemsText||""===scope.noItemsText||null===scope.noItemsText?(scope.hideDropdown=!0,scope.showNoItemsMessage=!1):(scope.hideDropdown=!1,scope.showNoItemsMessage=!0))}scope.callbackDefined="undefined"==typeof attrs.noItemsCallback?!1:!0,scope.predicate="undefined"!=typeof scope.sortBy?scope.sortBy:scope.label,scope.dropdown={isEnabled:!1,isOpen:!1},scope.loadingItems=!1,scope.selected={},scope.originalPlaceholder=scope.placeholder,scope.typeaheadTemplate="../ambassador/templates/directive.chooser.typeahead.html";var abortSearch;if(attrs.hasOwnProperty("newLook")?(scope.newLook=!0,scope.placeListBeneath=!0):scope.newLook=!1,"below"===attrs.position&&(scope.placeListBeneath=!0),"snippet"===attrs.appearance?scope.snippetAppearance=!0:scope.snippetAppearance=!1,scope.isManualEntry=attrs.hasOwnProperty("manualEntry"),scope.isManualEntry){scope.entered={isValid:function(){var valid=scope.validPattern?this.value.match(scope.validPattern):!0;return valid||element.addClass("has-error"),valid},value:""};var waitForInputEl=scope.$watch(function(){return element.find("input").length>0?!0:!1},function(inputEl){inputEl&&setBinding()})}element.bind("keydown",function(e){if((38===e.keyCode||40===e.keyCode)&&element[0].getElementsByClassName("dropdown-menu").length>0){var dropdownElem=element[0].getElementsByClassName("dropdown-menu")[0].getBoundingClientRect(),activeElem=element[0].getElementsByClassName("active")[0].getBoundingClientRect();activeElem.top+activeElem.height>dropdownElem.top+dropdownElem.height&&(element[0].getElementsByClassName("dropdown-menu")[0].scrollTop+=activeElem.top+activeElem.height-(dropdownElem.top+dropdownElem.height)),activeElem.top<dropdownElem.top&&(element[0].getElementsByClassName("dropdown-menu")[0].scrollTop-=dropdownElem.top-activeElem.top)}}),"undefined"==typeof scope.searchProperties&&(scope.searchProperties=[scope.label]),scope.$watch("model",function(){scope.showReset="undefined"!=typeof scope.model[scope.label]&&"undefined"!=typeof scope.model||scope.allowInputValue&&"string"==typeof scope.model&&""!==scope.model?!0:!1,scope.placeholder=scope.multi!==!0&&"undefined"!=typeof scope.model&&scope.model[scope.label]?scope.model[scope.label]:scope.originalPlaceholder,"undefined"!=typeof scope.model&&"undefined"!=typeof scope.property&&(scope.multi!==!0&&"true"!==scope.multi&&"object"==typeof scope.model?(scope.resultModel=scope.model[scope.property],scope.selected.item=scope.model[scope.property]):scope.allowInputValue?(scope.resultModel=scope.model,scope.selected.item=scope.model):(scope.resultModel=[],angular.forEach(scope.model,function(item){scope.resultModel.push(item[scope.property])}))),scope.data&&scope.data.length===scope.model.length&&handleEmptyDropdown(!0)},!0),scope.allowInputValue&&scope.$watch("selected.item",function(value){"undefined"!=typeof value&&"object"!=typeof value&&(scope.model=value)}),scope.multi!==!0&&scope.model[scope.label]&&(scope.placeholder=scope.model[scope.label]),scope.$watch("data",function(data){data&&(data.length<25&&!scope.allowInputValue?scope.dropdown.isEnabled=!0:scope.dropdown.isEnabled=!1,0===data.length?handleEmptyDropdown():scope.data.length===scope.model.length?handleEmptyDropdown(!0):(scope.hideDropdown=!1,scope.showNoItemsMessage=!1)),setClasses()},!0),scope.$watch("noItemsText",function(){scope.data&&0===scope.data.length&&handleEmptyDropdown()}),scope.noItemsFunction=function(){scope.dropdown.isOpen=!1,"function"==typeof scope.noItemsCallback&&scope.noItemsCallback()},scope.removeItem=function(item){var index=scope.model.indexOf(item);scope.model.splice(index,1),scope.showNoItemsMessage=!1},scope.addItem=function(item){scope.multi?(scope.model.push(item),scope.selected.item="",scope.isManualEntry&&(scope.entered.value="")):scope.model=item,scope.allowInputValue||(scope.selected.item=""),scope.dropdown.isOpen=!1},scope.addItemManual=function(item){var newItem={};if(newItem[scope.label]=item,scope.multi){var addItem=!0;angular.forEach(scope.model,function(item){item[scope.label]===newItem[scope.label]&&(element.addClass("has-error"),scope.entered.value="",addItem=!1)}),addItem&&scope.addItem(newItem)}else scope.addItem(newItem)},scope.resetField=function(){scope.isDisabled||(scope.model={},scope.placeholder=scope.originalPlaceholder,scope.selected.item="")},attrs.search?scope.searchFunction=function(val){var results=scope.search({val:val});return results}:scope.searchFunction=function(val){abortSearch&&abortSearch.resolve(),abortSearch=$q.defer();var defaultParams={search:val,ordering:scope.predicate,page_size:50,page:1},queryParams=angular.extend({},defaultParams);return"undefined"!=typeof scope.filterParams&&(queryParams="undefined"!=typeof scope.filterParams.async?angular.extend(defaultParams,scope.filterParams.async):angular.extend(defaultParams,scope.filterParams)),scope.loadingItems=!0,$api.use("default").all(scope.endpoint).withHttpConfig({timeout:abortSearch.promise}).getList(queryParams).then(function(data){var results=[];if(scope.model.length>0)for(var i=0;i<data.length;i++){var item=scope.filterChosen(data[i]);item&&results.push(item)}else results=data;return scope.loadingItems=!1,results})},scope.filterChosen=function(item){if(0===scope.model.length)return item;for(var chosen=!0,i=0,l=scope.model.length;l>i;i++)scope.comparator||item!==scope.model[i]?scope.comparator&&item[scope.comparator]===scope.model[i][scope.comparator]&&(chosen=!1):chosen=!1;return chosen?item:!1},scope.filterItems=function(item){if("undefined"==typeof scope.filterParams)return item;var params="undefined"!=typeof scope.filterParams.nonAsync?scope.filterParams.nonAsync:scope.filterParams,valid=!0;for(var key in params)params[key]!==item[key]&&(valid=!1);return valid?item:!1},scope.getMatchingItems=function($viewValue){if("true"!==attrs.searchWholeObject){for(var matchingItems=[],i=0;i<scope.data.length;i++)for(var j=0;j<scope.searchProperties.length;j++){var property=scope.searchProperties[j];if(-1!==scope.data[i][property].toString().toLowerCase().indexOf($viewValue.toString().toLowerCase())){matchingItems.push(scope.data[i]);break}}return matchingItems}return scope.data}}}}]).directive("gaRedactor",["$script","$api","$timeout","$window","CONVENTIONS_ENV",function($script,$api,$timeout,$window,CONVENTIONS_ENV){"use strict";return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){scope.redactorLoaded=!1;var editor,updateModel=function(value){$timeout(function(){scope.$apply(function(){ngModel.$setViewValue(value)})})},additionalOptions=attrs.gaRedactor?scope.$eval(attrs.gaRedactor):{},options={changeCallback:updateModel,imageUpload:$api.use("default").getUrl()+"/misc/images/.json",apiToken:$api.use("default").getToken(),apiTokenName:"Token",premailerEndpoint:$api.use("default").getUrl()+"/misc/premail/.json",deniedTags:["html","head","title","link","body","meta","script","applet"],plugins:["fontsize","fontcolor","fontfamily","gaimageupload","gaimporttemplate","taglist"],buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","image","table","link","alignment","horizontalrule"],buttonsHide:["backcolor"]};angular.extend(options,additionalOptions);var initRedactor=function(){var $_element=$(element);$timeout(function(){editor=$($_element).redactor(options),ngModel.$render()}),ngModel.$render=function(){angular.isDefined(editor)&&$timeout(function(){$($_element).redactor("set",ngModel.$viewValue||""),scope.redactorLoaded=!0})}};if("test"===CONVENTIONS_ENV)initRedactor();else{var redactorPrerequisites=[];if("production"===CONVENTIONS_ENV){var redactorPath=additionalOptions.redactorPath?additionalOptions.redactorPath:"bower_components/ambassador-conventions/";redactorPrerequisites=[redactorPath+"ga-redactor.min.js"]}else"development"===CONVENTIONS_ENV&&(redactorPrerequisites=["ambassador/scripts/lib/redactor/redactor.js","ambassador/scripts/lib/redactor/plugins/fontcolor.js","ambassador/scripts/lib/redactor/plugins/fontfamily.js","ambassador/scripts/lib/redactor/plugins/fontsize.js","ambassador/scripts/lib/redactor/plugins/gaimageupload.js","ambassador/scripts/lib/redactor/plugins/gaimporttemplate.js","ambassador/scripts/lib/redactor/plugins/taglist.js","ambassador/scripts/lib/redactor/plugins/donottranslate.js"]);$script.load(["//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"]).then(function(){$script.load(redactorPrerequisites).then(function(){$timeout(initRedactor)})})}}}}]).directive("gaSlider",["$parse","$timeout",function($parse,$timeout){return{restrict:"AE",template:'<input type="text" />',require:"ngModel",scope:{max:"=",min:"=",step:"=",value:"=",ngModel:"=",ngDisabled:"=",range:"=",sliderid:"=",formater:"&",onStartSlide:"&",onStopSlide:"&",onSlide:"&"},link:function($scope,element,attrs,ngModelCtrl,$compile){function initSlider(){attrs.ngChange&&ngModelCtrl.$viewChangeListeners.push(function(){$scope.$apply(attrs.ngChange)});var options={};$scope.sliderid&&(options.id=$scope.sliderid),$scope.min&&(options.min=parseFloat($scope.min)),$scope.max&&(options.max=parseFloat($scope.max)),attrs.step&&(options.step=parseFloat($scope.step)),attrs.precision&&(options.precision=parseFloat(attrs.precision)),attrs.orientation&&(options.orientation=attrs.orientation),$scope.value&&(angular.isNumber($scope.value)||angular.isArray($scope.value)?options.value=$scope.value:angular.isString($scope.value)&&(0===attrs.value.indexOf("[")?options.value=angular.fromJson($scope.value):options.value=parseFloat($scope.value))),$scope.range&&(options.range=$scope.range===!0),attrs.selection&&(options.selection=attrs.selection),attrs.tooltip&&(options.tooltip=attrs.tooltip),attrs.tooltipseparator&&(options.tooltip_separator=attrs.tooltipseparator),attrs.tooltipsplit&&(options.tooltip_split="true"===attrs.tooltipsplit),attrs.handle&&(options.handle=attrs.handle),attrs.reversed&&(options.reversed="true"===attrs.reversed),attrs.enabled&&(options.enabled="true"===attrs.enabled),attrs.naturalarrowkeys&&(options.natural_arrow_keys="true"===attrs.naturalarrowkeys),attrs.formater&&(options.formater=$scope.$eval($scope.formater)),options.range&&!options.value&&(options.value=[0,0]);var slider=new Slider(element.children()[0],options),updateEvent=attrs.updateevent||"slide";slider.on(updateEvent,function(ev){var sliderValue="undefined"!=typeof ev.value?ev.value:ev;ngModelCtrl.$setViewValue(sliderValue),$timeout(function(){$scope.$apply()})}),slider.on("slideStop",function(ev){var sliderValue="undefined"!=typeof ev.value?ev.value:ev;ngModelCtrl.$setViewValue(sliderValue),$timeout(function(){$scope.$apply()})});var sliderEvents={slide:"onSlide",slideStart:"onStartSlide",slideStop:"onStopSlide"};angular.forEach(sliderEvents,function(sliderEventAttr,sliderEvent){slider.on(sliderEvent,function(ev){if($scope[sliderEventAttr]){var invoker=$parse(attrs[sliderEventAttr]);invoker($scope.$parent,{$event:ev,value:ev.value}),$timeout(function(){$scope.$apply()})}})}),angular.isDefined(attrs.ngDisabled)&&$scope.$watch("ngDisabled",function(value){value?slider.disable():slider.enable()}),$scope.$watch("ngModel",function(value){slider.setValue(value)})}initSlider()}}}]).directive("expandTextarea",[function(){return{restrict:"A",link:function(scope,element,attrs){autosize(element)}}}]);