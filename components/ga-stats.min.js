angular.module("ngAmbassador.stats",["ngAmbassador.misc"]).directive("gaStatHorizontalBar",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.horizontal-bar.html",scope:{numerator:"=",denominator:"=",label:"="},link:function(scope,elm,attrs){scope.percent=scope.numerator/scope.denominator*100}}}]).directive("gaStatBoxOne",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-1.html",scope:{boxes:"=",autoWidth:"="},link:function(scope,elm,attrs){scope.styles={},scope.getStyles=function(){return scope.autoWidth===!0&&(scope.styles.width=100/scope.boxes.length+"%"),scope.styles}}}}]).directive("gaStatBoxTwo",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-2.html",scope:{boxes:"=",autoWidth:"=",fontMax:"@",fontMin:"@",fontMultiplier:"@"},link:function(scope,elm,attrs){scope.styles={},scope.max=scope.fontMax||32,scope.min=scope.fontMin||12,scope.multiplier=scope.fontMultiplier||1,scope.getStyles=function(){return scope.autoWidth===!0&&(scope.styles.width=100/scope.boxes.length+"%"),scope.styles}}}}]).directive("gaStatBoxThree",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/stats.box-3.html",scope:{boxes:"=",autoWidth:"="},link:function(scope,elm,attrs){scope.styles={},scope.getStyles=function(){return scope.autoWidth===!0&&(scope.styles.width=100/scope.boxes.length+"%"),scope.styles}}}}]).directive("gaProportionRings",[function(){return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/proportion-rings.html",scope:{total:"=",rings:"=",hideValue:"=?",direction:"@?",lineStyle:"@?",size:"=?",lineWidth:"=?"}}}]).directive("gaProportionRing",["$timeout",function($timeout){"use strict";function easeInOutQuad(tlength,dt,x0,dx){return dt/=tlength/2,dt<1?dx/2*dt*dt+x0:(dt--,-dx/2*(dt*(dt-2)-1)+x0)}var Angle0=-Math.PI/2,_2PI=2*Math.PI,PresetColors={blue:"#2f95d8",green:"#73ab76",red:"#ce6563",yellow:"#f4d10d",high:"#cd1f15",medium:"#f29b30",low:"#777777"},DefaultColor=PresetColors.blue,DefaultBackgroundColor="transparent";return{restrict:"E",replace:!0,templateUrl:"../ambassador/templates/stats/proportion-ring.html",scope:{total:"=",value:"=",name:"@",color:"=",background:"=?",hideValue:"=?",direction:"@?",lineStyle:"@?",size:"=?",lineWidth:"=?"},link:function(scope,elements){function determinColor(attrColor,defaultColor){var c=defaultColor,cSpec=attrColor;return cSpec&&("#"===cSpec.charAt(0)?c=cSpec:PresetColors.hasOwnProperty(cSpec)&&(c=PresetColors[cSpec])),c}function easing(elapsed){return easeInOutQuad(duration,elapsed,0,arcAngle)}function drawArc(angle){var endAngle=counterClockwise?Angle0+_2PI-angle:Angle0+angle;context.beginPath(),context.arc(center,center,radius,Angle0,endAngle,counterClockwise),context.stroke()}function draw(){if(!animating)return context.clearRect(0,0,outerDiameter,outerDiameter),void drawArc(arcAngle);window.requestAnimationFrame(draw);var elapsed=+new Date-animationStart;drawArc(easing(elapsed)),elapsed>=duration&&(animating=!1)}function initiateDraw(){canvas.getContext&&(animationStart=+new Date,drawArc(.001),window.requestAnimationFrame(draw))}function renderedWidth(el){return el.getBoundingClientRect().width}var e=elements[0],innerElement=e.querySelector(".ga-proportion-ring-inner"),size=scope.size?scope.size:150,thickness=scope.lineWidth?scope.lineWidth:8,outerDiameter=size,innerDiameter=size-2*thickness,center=outerDiameter/2,radius=center-thickness/2,counterClockwise="clockwise"!==scope.direction,color=determinColor(scope.color,DefaultColor),background=determinColor(scope.background,DefaultBackgroundColor);e.style.width=outerDiameter+"px",e.style.height=outerDiameter+"px",e.style.borderWidth=thickness+"px",innerElement.style.width=innerDiameter+"px",innerElement.style.height=innerDiameter+"px",innerElement.style.marginTop=0,innerElement.style.marginRight=thickness+"px",innerElement.style.marginBottom=thickness+"px",innerElement.style.marginLeft=0,innerElement.style.backgroundColor=background;var canvas=e.querySelector("canvas");canvas.width=outerDiameter,canvas.height=outerDiameter,canvas.style.marginTop="-"+thickness+"px",canvas.style.marginLeft="-"+thickness+"px";var proportion=scope.value/scope.total;proportion=Math.max(0,Math.min(proportion,1));var arcAngle=_2PI*proportion;arcAngle=Math.max(Math.min(_2PI-.001,arcAngle),.001);var duration=600*(2+proportion),context=canvas.getContext("2d");context.lineWidth=thickness,context.lineCap=scope.lineStyle?scope.lineStyle:"round",context.strokeStyle=color;var animationStart,animating=!0;scope.displayValue=Number(scope.value).toLocaleString(),scope.hideValue?(scope.textColor=color,angular.element(innerElement).addClass("ga-proportion-ring-hide-value")):scope.textColor=null;var maxWidth=renderedWidth(innerElement)-10,minFontSize=13,setFontSizeFor=["nominal"];scope.hideValue||setFontSizeFor.push("numeric"),$timeout(function(){angular.forEach(setFontSizeFor,function(which){for(var el=e.querySelector(".ga-proportion-ring-"+which+"-label"),fontSize=parseInt(getComputedStyle(el).fontSize);renderedWidth(el)>maxWidth&&fontSize>minFontSize;)el.style.fontSize=--fontSize+"px";el.style.color=scope.textColor,el.style.opacity=""}),initiateDraw()})}}}]),function(){var tempNumber=1e6*Math.PI;if(tempNumber.toLocaleString("de")===tempNumber.toLocaleString("fr")){var formatNumber=function(number,delimiter,decimalDelimiter){var numberString=number.toString(),splitNumber=numberString.split("."),splitFloats="";return splitNumber[1]&&splitNumber[1].length>3&&(splitFloats=decimalDelimiter+number.toFixed(3).toString().split(".")[1]),splitNumber[0].split(/(?=(?:\d{3})+$)/g).join(delimiter)+splitFloats};window.Number.prototype.toLocaleString=function(){var locale,navigatorLanguage,localeCharacters,localeMap={en:{delimiter:",",decimal:"."},au:{delimiter:",",decimal:"."},gb:{delimiter:",",decimal:"."},fr:{delimiter:" ",decimal:","},de:{delimiter:".",decimal:","},at:{delimiter:",",decimal:"."},fi:{delimiter:" ",decimal:","},nl:{delimiter:".",decimal:","},es:{delimiter:".",decimal:","},da:{delimiter:".",decimal:","},el:{delimiter:".",decimal:","},et:{delimiter:" ",decimal:","},it:{delimiter:".",decimal:","},pl:{delimiter:" ",decimal:","},sv:{delimiter:" ",decimal:","},ru:{delimiter:" ",decimal:","},no:{delimiter:",",decimal:"."}};return navigatorLanguage=navigator&&navigator.language||"en",navigatorLanguage=navigatorLanguage.replace(/\-\w+$/g,""),locale=arguments[0]||navigatorLanguage,localeCharacters=localeMap[locale],localeCharacters?formatNumber(this,localeCharacters.delimiter,localeCharacters.decimal):this.valueOf()}}}();