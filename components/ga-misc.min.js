angular.module("ngAmbassador.misc",["ngAmbassador.services"]).directive("clickAnywhereButHere",["$document",function($document){return{restrict:"A",link:function(scope,elem,attr,ctrl){elem.bind("click",function(e){e.stopPropagation()}),$document.bind("click",function(){scope.$apply(attr.clickAnywhereButHere)})}}}]).directive("fillParent",["$window",function($window){return{link:function(scope,element,attrs){function setHeight(){var parentHeight=window.getComputedStyle(element.parent()[0]).height;element[0].style.minHeight=parentHeight}scope.$watch(function(){setHeight()}),angular.element($window).bind("resize",function(){setHeight()})}}}]).directive("gaEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.gaEnter)}),event.preventDefault())})}}).directive("gaLoader",["$timeout","$window",function($timeout,$window){return{restrict:"E",replace:!0,template:'<div ng-class="{\'fade-in\':loading===true, \'fade-out\':loading===false }" class="ga-loader"><div ng-if="showLoader" class="ga-spinner"><span class="loader-text">{{ loaderText || \'Loading\' }}</span><svg class="spinner" width="100px" height="100px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="5" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div>',scope:{loading:"=",activePositioning:"@",loaderText:"="},link:function(scope,elm,attrs){function renderedWidth(el){return el.getBoundingClientRect().width}function adjustFontSize(){var innerElement=scope.thisElement.querySelector(".ga-spinner"),el=scope.thisElement.querySelector(".loader-text");if(el)for(var fontSize=parseInt(getComputedStyle(el).fontSize),maxWidth=renderedWidth(innerElement)-25;renderedWidth(el)>maxWidth&&12<fontSize;)el.style.fontSize=--fontSize+"px"}function keepSpinnerInView(){if(scope.showLoader){var tableBounds=scope.thisElement.getBoundingClientRect(),spinner=angular.element(scope.thisElement.children[0]),isTopHidden=tableBounds.top<0,isBottomHidden=tableBounds.bottom>window.innerHeight,spinnerTop=null;if(isTopHidden&&isBottomHidden)spinnerTop=-tableBounds.top+window.innerHeight/2;else if(isTopHidden){var y=(tableBounds.height-tableBounds.top)/2;spinnerTop=Math.min(y,tableBounds.height-50)}else if(isBottomHidden){y=(tableBounds.height-(tableBounds.bottom-window.innerHeight))/2;spinnerTop=Math.max(50,y)}spinner.css("top",spinnerTop?spinnerTop+"px":"")}}scope.thisElement=elm[0],scope.showLoader=!0===scope.loading,scope.activeSpinnerPositioning=!0,"false"===scope.activePositioning&&(scope.activeSpinnerPositioning=!1),scope.$watch("loading",function(newValue,oldValue){scope.loading?(scope.showLoader=!0,scope.activeSpinnerPositioning&&$timeout(keepSpinnerInView,1),$timeout(adjustFontSize,1)):newValue!==oldValue&&$timeout(function(){scope.showLoader=!1},300)}),scope.activeSpinnerPositioning&&angular.element($window).bind("resize scroll",keepSpinnerInView)}}}]).directive("gaValueTemplate",["$compile",function($compile){return{restrict:"E",scope:{value:"=",responsive:"=",compression:"=",min:"=",max:"=",scopeLevel:"@"},replace:!0,template:"<div ng-style='{fontSize:fontSize}'></div>",link:function(scope,element,attrs){element.html(scope.value),void 0===scope.scopeLevel&&(scope.scopeLevel=3);for(var valueScope=scope,i=1;i<=scope.scopeLevel;i++)valueScope=valueScope.$parent;$compile(element.contents())(valueScope),scope.compressor=scope.compression||1,scope.minFontSize=scope.min||Number.NEGATIVE_INFINITY,scope.maxFontSize=scope.max||Number.POSITIVE_INFINITY,scope.elementWidth=element[0].offsetWidth,scope.resizer=function(){scope.elementWidth=element[0].offsetWidth,scope.fontSize=Math.max(Math.min(scope.elementWidth/(10*scope.compressor),parseFloat(scope.maxFontSize)),parseFloat(scope.minFontSize))+"px"},scope.responsive&&(scope.resizer(),scope.$watch("value",function(){scope.resizer()}),angular.element(window).bind("resize",function(){scope.$apply(scope.resizer)}),scope.$watch(function(){return element[0].offsetWidth},function(){scope.resizer()}))}}}]).directive("gaCurrency",["$filter",function($filter){return{restrict:"E",replace:!0,scope:{type:"=",amount:"=",pointsLabel:"=",currency:"=",typesConfig:"=",showTooltip:"@"},template:"<div class='ga-currency'><div ng-if='!isMonetary'><span ng-if='showTooltip' ga-dynamic-tooltip='{{dynamicTooltip}}' ga-dynamic-tooltip-placement='{{showTooltip}}'><span><var>{{displayAmount}}</var>{{displayPointsLabel}}</span></span><span ng-if='!showTooltip'><span><var>{{displayAmount}}</var>{{displayPointsLabel}}</span></span></div><div ng-if='isMonetary'><span ng-if='showTooltip' ga-dynamic-tooltip='{{dynamicTooltip}}' ga-dynamic-tooltip-placement='{{showTooltip}}'>{{displayAmount}}</span><span ng-if='!showTooltip'>{{displayAmount}}</span></div></div>",link:function(scope,element,attrs,ctrl){var currencies={USD:"$",GBP:"£",SGD:"S$",EUR:"€",AUD:"A$",ZAR:"R",BRL:"R$",CAD:"C$",NZD:"NZ$",CHF:"Fr. ",MXN:"Mex$ ",CLP:"$"};scope.$watch("amount",function(){var filter,amountTest;filter=$filter("currency"),amountTest=parseFloat(scope.amount),angular.isDefined(scope.type)&&angular.isDefined(scope.typesConfig)&&-1!==scope.typesConfig.nonMonetary.indexOf(scope.type)?(scope.displayAmount=filter(amountTest,"",2),scope.displayPointsLabel=" "+scope.pointsLabel,scope.dynamicTooltip="<var>"+scope.displayAmount+"</var> "+scope.displayPointsLabel,scope.isMonetary=!1):(scope.displayAmount=scope.displayAmountHtml=scope.dynamicTooltip=filter(amountTest,currencies[scope.currency],2),scope.isMonetary=!0)})}}}]).directive("gaAvatar",["$filter",function($filter){return{restrict:"E",scope:{image:"=",disableFade:"=",alt:"@"},template:"<div class='ga-avatar'><img ng-src='{{image}}' ng-class='{ \"fade-in\": avatarLoaded===true }' ></div>",link:function(scope,element,attrs){var newImg=new Image;newImg.onload=function(){var isVertical=!0;newImg.height<newImg.width&&(isVertical=!1),element.find("img").addClass(isVertical?"vertical":"horizontal")},newImg.src=scope.image,!0!==scope.disableFade?element.find("img").bind("load",function(event){scope.avatarLoaded=!0,scope.$$phase||scope.$apply()}):scope.avatarLoaded=!0}}}]).directive("gaDynamicTooltip",["$window","$sanitize",function($window,$sanitize){return{restrict:"A",transclude:!0,template:'<div uib-tooltip="{{tooltipText}}" tooltip-placement="{{tooltipPlacement}}" tooltip-append-to-body="{{appendToBody}}"><span ng-transclude /></div>',link:function(scope,element,attrs){scope.tooltipText="",scope.tooltipPlacement=angular.isDefined(attrs.gaDynamicTooltipPlacement)?attrs.gaDynamicTooltipPlacement:"top",scope.appendToBody=!!angular.isDefined(attrs.appendToBody)&&attrs.appendToBody,scope.minWidthToShowTooltip=!!angular.isDefined(attrs.showTooltipAfter)&&parseInt(attrs.showTooltipAfter);var count=0,waitForTooltipToRender=scope.$watch(function(){var innerWidth=element.find("span")[0].getBoundingClientRect().width,outerWidth=element.children()[0].getBoundingClientRect().width;if(5<=++count&&waitForTooltipToRender(),0<innerWidth&&0<outerWidth)return scope.minWidthToShowTooltip?innerWidth>scope.minWidthToShowTooltip:outerWidth<=innerWidth},function(showTooltip){tooltipHandler(showTooltip)});function tooltipHandler(showTooltip){scope.tooltipText=showTooltip?$sanitize(attrs.gaDynamicTooltip):""}angular.element($window).bind("resize",function(){var innerWidth=element.find("span")[0].getBoundingClientRect().width,outerWidth=element.children()[0].getBoundingClientRect().width;0<innerWidth&&0<outerWidth&&(scope.minWidthToShowTooltip?tooltipHandler(innerWidth>scope.minWidthToShowTooltip):tooltipHandler(outerWidth<=innerWidth))})}}}]).directive("gaEnter",function(){return function(scope,element,attrs){element.bind("keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.gaEnter)}),event.preventDefault())})}}).directive("gaMicroLoader",[function(){return{restrict:"E",replace:!0,template:'<div class="micro-loader-wrap" ng-class="{\'loading\':loading===true}"><div class="loader-bounce"><div class="bounce1" ng-style="{\'background-color\':fillColor}"></div><div class="bounce2" ng-style="{\'background-color\':fillColor}"></div><div class="bounce3" ng-style="{\'background-color\':fillColor}"></div><div></div>',scope:{loading:"=",fillColor:"=?"},link:function(scope,elm,attrs){scope.fillColor||(scope.fillColor="#BDC2C7")}}}]);